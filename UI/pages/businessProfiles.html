<!DOCTYPE html>
<html lang="en">

<head>

    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimal-ui">
    <meta name="description" content="Frest admin is super flexible, powerful, clean &amp; modern responsive bootstrap 4 admin template with unlimited possibilities.">
    <meta name="keywords" content="admin template, Frest admin template, dashboard template, flat admin template, responsive admin template, web app">
    <meta name="author" content="PIXINVENT">
    <title>Business Profiles</title>
    <link rel="apple-touch-icon" href="../../app-assets/images/ico/apple-icon-120.png">
    <link rel="shortcut icon" type="image/x-icon" href="../../app-assets/images/ico/favicon.ico">
    <link href="https://fonts.googleapis.com/css?family=Rubik:300,400,500,600%7CIBM+Plex+Sans:300,400,500,600,700" rel="stylesheet">


    <link rel="stylesheet" type="text/css" href="../../app-assets/vendors/css/vendors.min.css">
    <link rel="stylesheet" type="text/css" href="../../app-assets/vendors/css/charts/apexcharts.css">
    <link rel="stylesheet" type="text/css" href="../../app-assets/vendors/css/extensions/swiper.min.css">
    <link rel="stylesheet" href="../../css/font-awesome-4.7.0/css/font-awesome.min.css">



    <link rel="stylesheet" type="text/css" href="../../app-assets/css/bootstrap.css">
    <link rel="stylesheet" type="text/css" href="../../app-assets/css/bootstrap-extended.css">
    <link rel="stylesheet" type="text/css" href="../../app-assets/css/colors.css">
    <link rel="stylesheet" type="text/css" href="../../app-assets/css/components.css">


    <link rel="stylesheet" type="text/css" href="../../app-assets/css/core/menu/menu-types/horizontal-menu.css">
    <link rel="stylesheet" type="text/css" href="../../app-assets/css/pages/dashboard-ecommerce.css">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons " rel="stylesheet ">




    <link rel="icon" href="../../img/core-img/favicon.png" />


    <link rel="stylesheet" href="../../css/responsive.css" />

    <link rel="stylesheet" type="text/css" href="../../css/custom.css" />


    <script src="../../js/modernizr.js"></script>

    <style>
        .main-section{
            height: 100vh;
        }
        .profile-cards{
            height: 80vh;
            overflow-y: scroll;
        }
        #business-image{
            width: auto;
            height: 100px;
        }
        .profile-cards::-webkit-scrollbar{
            display: none;
        }
        .search-background{
            height: 200px;
        }
    </style>
</head>

<body>

    <!-- ***** Header Area Start ***** -->
    <!-- <section> -->
        <header class="headroom mb-4" >

            <nav class="navbar navbar-expand-md navbar-dark bg-dark fixed-top ">
                <a href="./admin.html "><img src="../../img/bg-img/logo.png " class="img-fluid logo-width " alt="Brand Logo " /></a>
                <button class="navbar-toggler " type="button " data-toggle="collapse " data-target="#navbarsExampleDefault " aria-controls="navbarsExampleDefault " aria-expanded="false " aria-label="Toggle navigation ">
            <span class="navbar-toggler-icon "></span>
          </button>
    
                <div class="collapse navbar-collapse " id="navbarsExampleDefault ">
                    <ul class="navbar-nav mr-auto " id="Tnavlist ">
    
                    </ul>
                    <ul class="float-right navbar-nav" id="profileContainer">
    
                    </ul>
                        
    
                </div>
            </nav>
    
    
        </header>
    <!-- </section> -->

    <section>
        <div class="container-fluid bg-white float-left" style="width:100% !important;">
            
            <div class="row align-items-center">
                <!-- Menu Area Start -->
                <div class="col-12">
                    <div class="menu_area">
                        
                    </div>
                </div>
            </div>
        </div>
    </section>
    <div class="container main-section" style="margin-top: 2%;">
        
        <div class="row">
            <div class="header-image">
                <img src="#" alt="" class="search-background">
            </div>
        </div>
        <div class="row">
            <div class="col-md-3" style="height: 100vh;">
                <div class="side-bar card">
                    <div class="card-body">
                        <div class="card-header">
                            <h3 class="">
                                Filters
                            </h3>
                        </div>
                        <div class="col" id="filter-container">
                            
                        </div>
                        
                    </div>
                </div>
            </div>
            <div class="col-md-9">
                <div class="row search-bar ">
                    <div class="row  col-12  align-items-center">
                        <div class="col-md-6 col-12">
                            <!-- search bar -->
                            <input type="search" class="form-control rounded-right form-control-lg shadow pl-2" id="searchBar"
                      placeholder="Search">
                        </div>
                        <div class="col-md-1 col-12">
                            <!-- search button -->
                            <button class="btn btn-primary search-btn rounded" type="button" id="searchBtn">
                                <span class="d-none d-sm-block">Search</span>
                            </button>
                        </div>
                    </div>
                </div>
                <div class="row profile-cards">
                    <div class="row  col-md-12" id="profileCards" style="margin-top:30px">
                        <!-- no pfoiles image -->
                        <img src="https://i.pinimg.com/originals/ae/8a/c2/ae8ac2fa217d23aadcc913989fcc34a2.png"  alt="">
                    </div>
                </div>
            </div>
        </div>
       
        
    </div>
    <!-- ***** Footer Area End ***** -->
    <!-- Start of Async Drift Code -->
    <script>
        "use strict";

        !(function() {
            var t = (window.driftt = window.drift = window.driftt || []);
            if (!t.init) {
                if (t.invoked) return void(window.console && console.error && console.error("Drift snippet included twice."));
                (t.invoked = !0),
                (t.methods = ["identify", "config", "track", "reset", "debug", "show", "ping", "page", "hide", "off", "on"]),
                (t.factory = function(e) {
                    return function() {
                        var n = Array.prototype.slice.call(arguments);
                        return n.unshift(e), t.push(n), t;
                    };
                }),
                t.methods.forEach(function(e) {
                        t[e] = t.factory(e);
                    }),
                    (t.load = function(t) {
                        var e = 3e5,
                            n = Math.ceil(new Date() / e) * e,
                            o = document.createElement("script");
                        (o.type = "text/javascript"),
                        (o.async = !0),
                        (o.crossorigin = "anonymous"),
                        (o.src = "https://js.driftt.com/include/" + n + "/" + t + ".js");
                        var i = document.getElementsByTagName("script")[0];
                        i.parentNode.insertBefore(o, i);
                    });
            }
        })();
        drift.SNIPPET_VERSION = "0.3.1";
        drift.load("6ashbsefxhx7");
    </script>
    <!-- End of Async Drift Code -->
    <!-- ***** App Screenshots Area End *****====== -->
    <script>
        (function(i, s, o, g, r, a, m) {
            i["GoogleAnalyticsObject"] = r;
            (i[r] =
                i[r] ||
                function() {
                    (i[r].q = i[r].q || []).push(arguments);
                }),
            (i[r].l = 1 * new Date());
            (a = s.createElement(o)), (m = s.getElementsByTagName(o)[0]);
            a.async = 1;
            a.src = g;
            m.parentNode.insertBefore(a, m);
        })(window, document, "script", "https://www.google-analytics.com/analytics.js", "ga");

        ga("create", "UA-96096445-4", "auto");
        ga("send", "pageview");
    </script>
    <!-- Go to www.addthis.com/dashboard to customize your tools -->
    <!-- <script src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-58d9fa1af7a79649"></script> -->
    <!-- Jquery-2.2.4 JS -->
    <script src="../../js/jquery-2.2.4.min.js"></script>
    <!-- Headroom js -->
    <script src="../../js/headroom.js"></script>
    <!-- Popper js -->
    <script src="../../js/popper.min.js"></script>
    <!-- Bootstrap-4 Beta JS -->
    <script src="../../js/bootstrap.min.js"></script>
    <!-- All Plugins JS -->
    <script src="../../js/plugins.js"></script>
    <!-- Active JS -->
    <script src="../../js/active.js"></script>
    <!-- Resource jQuery -->
    <script src="../../js/jquery.mobile.custom.min.js"></script>
    <!-- Resource jQuery -->
    <script src="../../js/main.js"></script>

    <script src="../../app-assets/vendors/js/vendors.min.js"></script>
    <script src="../../app-assets/fonts/LivIconsEvo/js/LivIconsEvo.tools.js"></script>
    <script src="../../app-assets/fonts/LivIconsEvo/js/LivIconsEvo.defaults.js"></script>
    <script src="../../app-assets/fonts/LivIconsEvo/js/LivIconsEvo.min.js"></script>
    <!-- BEGIN Vendor JS-->

    <!-- BEGIN: Page Vendor JS-->
    <script src="../../app-assets/vendors/js/ui/jquery.sticky.js"></script>
    <!-- END: Page Vendor JS-->

    <!-- BEGIN: Theme JS-->
    <script src="../../app-assets/js/scripts/configs/horizontal-menu.js"></script>
    <script src="../../app-assets/js/core/app-menu.js"></script>
    <script src="../../app-assets/js/core/app.js"></script>
    <script src="../../app-assets/js/scripts/components.js"></script>
    <script src="../../app-assets/js/scripts/footer.js"></script>
    <!-- END: Theme JS-->
    <!-- Headroom -->
    <script src="../../js/globalFuntions.js"></script>
    <script>
    const myHeaders = new Headers();
    var profileList = [];
    
    var userData = {}
    async function profile(){
        var authRequestOptions = {
        method : "POST",
        redirect : "follow",
        headers : myHeaders,
        body : ""
        }
        var result = await fetch("../../ws/auth.php",authRequestOptions)
        .then(response => response.json());
        return result;
    }
    async function loadData(){
        try{
            profile().then(response =>{
                userData = response;
                loadProfiles();
            })
        }
        catch(error){
            console.log(error);
        }
    }
    loadData();
    function search(){
        var searchBar = document.getElementById('searchBar');
        searchBar.addEventListener('keyup' , (e)=>{
            console.log(e.target.value);
            const searchString = e.target.value.toLowerCase();
            const filteredProfiles = profileList.filter( profile =>{
                return (
                    profile.ContentName.toLowerCase().includes(searchString) ||
                    profile.Name.toLowerCase().includes(searchString)
                );
            })
            // console.log(filteredProfiles);
            displayMembers(filteredProfiles);
        })
    }
    async function loadProfiles(){
        var businessBody = {
          load : "loadallMemdata"
        }
        businessBody = JSON.stringify(businessBody);
        var businessRequestOptions = {
          method : "POST",
          headers : myHeaders,
          redirect : "follow",
          body : businessBody
        }
        fetch("../../ws/businessprofile.php",businessRequestOptions)
        .then(response => response.json())
        .then(result => {
            console.log(result);
            if(Array.isArray(result)){
                profileList = result;
                profileList.forEach(profile=>{
                    var loadContactsBody = {
                        load : "loadmemcontacts",
                        id : profile.userid,
                        category : profile.ContentName
                    }
                    loadContactsBody = JSON.stringify(loadContactsBody);
                    var loadContactsOptions = {
                        method : "POST",
                        redirect : "follow",
                        headers : myHeaders,
                        body : loadContactsBody
                    }
                    fetch("../../ws/businessprofile.php",loadContactsOptions)
                    .then(response => response.json())
                    .then(result => {
                        console.log(result);
                        var email = "no email";
                        var phoneNumber = "no number";
                        if(Array.isArray(result)){
                            result.forEach(item=>{
                                if(item.ContentName === "Phone Number"){
                                    phoneNumber = item.contactdetails;
                                }else if(item.ContentName === "Email"){
                                    email = item.contactdetails
                                }
                            });
                        }
                        var inedx = profileList.indexOf(profile);
                        profile.email = email;
                        profile.phoneNumber  = phoneNumber;
                        console.log(profileList[inedx]);
                        profileList[inedx] = profile;
                        console.log(profile);
                    })
                    .then(()=>{
                        displayMembers(profileList);
                    })
                    .catch(error =>{
                        // noConnection();
                        console.log(error);
                    });
                })
            }
            else{
                console.log("hello");
                var mainSection = document.querySelector('.main-section');
                mainSection.innerHTML  = "";
                var button = `<div class="col-6 text-center">
                                    <a href="./main.html" class="btn btn-primary">Add Profiles</a>
                                </div>`;
                if(userData.admin == 0){
                    button = "";
                }
                var businessProfiles = document.createElement('div');
                businessProfiles.innerHTML = `<div class="row align-items-center justify-content-around">
                                                <div class="col-4">
                                                    <img src="#" alt="" id="emptyImage">
                                                    <h4 class="text-center">No Profiles</h4>
                                                </div>
                                                `+button+`
                                            </div>`;
                //make a template for the empty state;
                //call empty state function with business profile template as argument
                emptyState(businessProfiles,myHeaders).then((result)=>{
                    mainSection.appendChild(result.firstChild);
                })
            }
        })
        .catch(error =>{console.log(error);});    
    }
    function displayMembers(profiles){
        console.log(profiles);
        var editBtn = "";
        var referBtn = "";
        if(userData.status === "Logged In"){
            referBtn = `<button class="btn btn-primary mr-1">Refer</button>`;
            if(userData.admin == 0)
                editBtn = `<button class="btn btn-primary mr-1">Edit Profile</button>`;
        }
        console.log(profiles);
        var profileCards = document.getElementById('profileCards');
        const cardHtml = (profiles)
            .map((profile) =>{
                if(profile.logo === ""){
                    profile.logo = "../../images/emptystates/logo.jpg";
                }
                var card = document.createElement("div");
                card.innerHTML = `<div class="col-md-12 profile-card">
                    <div class="card " style="margin-bottom: 5%;">
                        <div class="card-body py-1 m-1">
                            <div class="col">
                                <div class="row ">
                                    <div class="col-md-4 col-12 ">
                                        <span>`+profile.BusinessName+`</span>
                                    </div>
                                    <div class="col-md-4 col-12">
                                        <span>`+profile.Name+`</span>
                                    </div>
                                    <div class="col-md-4 col-12">
                                        <span>`+profile.ContentName+`</span>
                                    </div>
                                </div>
                                <div class="row mt-2">
                                    <div class="col-md-4 col-12">
                                        <img src="`+profile.logo+`" id="business-image" alt="business image">
                                    </div>
                                    <div class="col-md-4 col-12" >
                                        <div class="row mb-2">
                                            <span class="material-icons mr-1">
                                                phone
                                            </span>
                                            <span >
                                                `+profile.phoneNumber+`
                                            </span>
                                        </div>
                                        <div class="row">
                                            <span class="material-icons mr-1">
                                                mail
                                            </span>
                                            <span>
                                                `+profile.email+`
                                            </span>
                                        </div>
                                    </div>
                                    <div class="col-md-4 col-12">
                                        `+profile.Address+`
                                    </div>
                                </div>
                                <div class="card-footer" style="margin-bottom:-7%">
                                    <div class="row justify-content-end">
                                        `+editBtn+`
                                        <button class="btn btn-primary mr-1" onclick="viewProfile('`+profile.ContentName+`','`+profile.userid+`')">View Profile</button>
                                        `+referBtn+`
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;  
            
            
            return card.innerHTML; 
        }).join('');
        profileCards.innerHTML = cardHtml;
    }
    function viewProfile(category,memberid){
        window.open(`./viewBusinessProfile.html?category=`+category+`&memberid=`+memberid,'_self');
    }
    async function loadContactDetails(contactDiv,category,id){
        
        return true;
    }
    function applyFilters(){
        var filteredProfiles = profileList;
        //target each set of radio buttons
        var categoryFilter = document.querySelector('input[name="categoriesfilter"]:checked');
        console.log(categoryFilter);
        var groupFilter = document.querySelector('input[name="chaptersfilter"]:checked');
        var chapterFilter = document.querySelector('input[name="groupsfilter"]:checked');

        //for each value run a different filter
        if(categoryFilter){
            console.log(categoryFilter.value);
            if(categoryFilter.value != "all"){
                var searchId = categoryFilter.value.toLowerCase();
                filteredProfiles = filteredProfiles.filter( item =>{
                    return (
                        item.ContentName.toLowerCase() === searchId
                    );
                })
            }
            
        }
        if(groupFilter){
            console.log(groupFilter.value);
            if(groupFilter.value != "all"){
                var searchId = groupFilter.value.toLowerCase();
                filteredProfiles = filteredProfiles.filter( item =>{
                    //
                })
            }
        }
        if(chapterFilter){
            console.log(chapterFilter.value);
            if(chapterFilter.value != "all"){
                var searchId = chapterFilter.value.toLowerCase();
                filteredProfiles = filteredProfiles.filter( item =>{
                    //
                })
            }
        }
        //initially profileList is unfiltered
        //apply each filter and change filtered profiles value
        //send final data to display profiles
        displayMembers(filteredProfiles);
    }
    function loadFilter(filter){
        
        var filterOptions = {
            load : "loadbyparent",
            id : filter
        }
        filterOptions = JSON.stringify(filterOptions);
        var filterRequest = {
            method : "POST",
            redirect : "follow",
            headers : myHeaders,
            body : filterOptions
        }
        fetch("../../ws/Accessconfig.php",filterRequest)
        .then(response => response.json())
        .then(result => {
            console.log(result);
            if(Array.isArray(result)){
                var filterOptions = `<div class="row m-2">
                                        <div class="radio">
                                            <input type="radio" class="checkbox-input" id="`+filter+`all" name="`+filter+`filter" value="all">
                                            <label for="`+filter+`all">All</label>
                                        </div>
                                    </div>`;
                result.forEach(element => {
                    filterOptions = filterOptions+ `<div class="row m-2">
                                                        <div class="radio">
                                                            <input type="radio" class="checkbox-input" id="`+element.ContentName+`" name="`+filter+`filter" value="`+element.ContentName+`">
                                                            <label for="`+element.ContentName+`">`+element.ContentName+`</label>
                                                        </div>
                                                    </div>`;
                });
                var filterContainer = document.getElementById(filter+`-filters`);
                filterContainer.innerHTML = filterOptions;
            }
        })
        .then(()=>{
            var options = document.querySelectorAll(`input[name="`+filter+`filter"]`);
            options = Array.from(options);
            options.forEach((option)=>{
                option.addEventListener('click',()=>{
                    applyFilters();
                });
            });
        })
        .catch(error =>{console.log(error);});
    }
    function loadFilters(){
        var filterNames = ["categories","chapters", "groups"];
        var div = document.createElement('div');
        var filterContainer= document.getElementById('filter-container');
        filterNames.forEach((filter)=>{
            //create filter element
            div.innerHTML = `<div class="row ml-1">
                                <h5>`+filter+`</h5>
                            </div>
                            <div id="`+filter+`-filters" >

                            </div>`;
            filterContainer.appendChild(div.firstChild);
            filterContainer.appendChild(div.firstChild.nextSibling);
            loadFilter(filter);
        })
        
    }
    
    loadFilters();
    </script>
</body>

</html>