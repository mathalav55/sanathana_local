<!DOCTYPE html>
<!-- saved from url=(0128)https://www.pixinvent.com/demo/frest-clean-bootstrap-admin-dashboard-template/html/ltr/horizontal-menu-template/form-layout.html -->
<html class="loaded" lang="en" data-textdirection="ltr">
<!-- BEGIN: Head-->

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0">
    <meta name="description" content="Frest admin is super flexible, powerful, clean &amp; modern responsive bootstrap 4 admin template with unlimited possibilities.">
    <meta name="keywords" content="admin template, Frest admin template, dashboard template, flat admin template, responsive admin template, web app">
    <meta name="author" content="PIXINVENT">
    <title>Referrals</title>
    <link rel="apple-touch-icon" href="https://www.pixinvent.com/demo/frest-clean-bootstrap-admin-dashboard-template/app-assets/images/ico/apple-icon-120.png">
    <link rel="shortcut icon" type="image/x-icon" href="https://www.pixinvent.com/demo/frest-clean-bootstrap-admin-dashboard-template/app-assets/images/ico/favicon.ico">
    <link href="../../css/css"rel=" stylesheet ">

    <!-- BEGIN: Vendor CSS-->
    <link rel="stylesheet " type="text/css " href="../../css/vendors.min.css ">
    <!-- END: Vendor CSS-->

    <!-- BEGIN: Theme CSS-->
    <link rel="stylesheet " type="text/css " href="../../css/Form Layouts - Frest - Bootstrap HTML admin template_files/bootstrap.min.css ">
    <link rel="stylesheet " type="text/css " href="../../css/Form Layouts - Frest - Bootstrap HTML admin template_files/bootstrap-extended.min.css ">
    <link rel="stylesheet " type="text/css " href="../../css/Form Layouts - Frest - Bootstrap HTML admin template_files/colors.min.css ">
    <link rel="stylesheet " type="text/css " href="../../css/Form Layouts - Frest - Bootstrap HTML admin template_files/components.min.css ">
    <link rel="stylesheet " type="text/css " href="../../css/Form Layouts - Frest - Bootstrap HTML admin template_files/dark-layout.min.css ">
    <link rel="stylesheet " type="text/css " href="../../css/Form Layouts - Frest - Bootstrap HTML admin template_files/semi-dark-layout.min.css ">
    <!-- END: Theme CSS-->

    <!-- BEGIN: Page CSS-->
    <link rel="stylesheet " type="text/css " href="../../css/horizontal-menu.min.css ">
    <!-- END: Page CSS-->

    <!-- BEGIN: Custom CSS-->
    <link rel="stylesheet " type="text/css " href="../../css/style.css ">
    <!-- END: Custom CSS-->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons " rel="stylesheet ">

    <link rel="apple-touch-icon " href="../../app-assets/images/ico/apple-icon-120.png ">
    <link rel="shortcut icon " type="image/x-icon " href="../../app-assets/images/ico/favicon.ico ">
    <link href="https://fonts.googleapis.com/css?family=Rubik:300,400,500,600%7CIBM+Plex+Sans:300,400,500,600,700 " rel="stylesheet ">


    <link rel="stylesheet " type="text/css " href="../../app-assets/vendors/css/vendors.min.css ">
    <link rel="stylesheet " type="text/css " href="../../app-assets/vendors/css/charts/apexcharts.css ">
    <link rel="stylesheet " type="text/css " href="../../app-assets/vendors/css/extensions/swiper.min.css ">
    <link rel="stylesheet " href="../../css/font-awesome-4.7.0/css/font-awesome.min.css ">



    <link rel="stylesheet " type="text/css " href="../../app-assets/css/bootstrap.css ">
    <link rel="stylesheet " type="text/css " href="../../app-assets/css/bootstrap-extended.css ">
    <link rel="stylesheet " type="text/css " href="../../app-assets/css/colors.css ">
    <link rel="stylesheet " type="text/css " href="../../app-assets/css/components.css ">


    <link rel="stylesheet " type="text/css " href="../../app-assets/css/core/menu/menu-types/horizontal-menu.css ">
    <link rel="stylesheet " type="text/css " href="../../app-assets/css/pages/dashboard-ecommerce.css ">





    <link rel="icon " href="../../img/core-img/favicon.png " />


    <link rel="stylesheet " href="../../css/responsive.css " />

    <link rel="stylesheet " type="text/css " href="../../css/custom.css " />


    <script src="../../js/modernizr.js "></script>




</head>
<!-- END: Head-->

<style>
    body {
        font-family: Arial, Helvetica, sans-serif;
    }
    /* The Modal (background) */
    
    .modal {
        display: none;
        /* Hidden by default */
        position: fixed;
        /* Stay in place */
        z-index: 1;
        /* Sit on top */
        padding-top: 100px;
        /* Location of the box */
        left: 0;
        top: 0;
        width: 100%;
        /* Full width */
        height: 100%;
        /* Full height */
        /* Enable scroll if needed */
        background-color: rgb(0, 0, 0);
        /* Fallback color */
        background-color: rgba(0, 0, 0, 0.4);
        /* Black w/ opacity */
    }
    /* Modal Content */
    
    .modal-content {
        background-color: #fefefe;
        margin: auto;
        padding: 20px;
        border: 1px solid #888;
        width: 80%;
        height: 100%;
    }
    /* The Close Button */
    
    .close {
        color: #aaaaaa;
        float: right;
        font-size: 28px;
        font-weight: bold;
    }
    
    .close:hover,
    .close:focus {
        color: #000;
        text-decoration: none;
        cursor: pointer;
    }
    #addForm{
        display: none;
    }
    #list-view{
        display: none;
    }
    .material-icons.active{
        color: #5a8dee;
    }
    .material-icons.inactive{
        color : #c7c7c7;
    }
    .stat:hover{
        background-color: #5a8eee6c;
        cursor: pointer;
    }
</style>

<!-- BEGIN: Body-->

<body class="horizontal-layout navbar-static 2-columns footer-static pace-done menu-expanded horizontal-menu " data-open="hover " data-menu="horizontal-menu " data-col="2-columns ">


    <header class="headroom " style="margin-bottom: 30px; ">

        <nav class="navbar navbar-expand-md navbar-dark bg-dark fixed-top ">
            <a href="./admin.html "><img src="../../images/emptystates/logo.jpg" class="img-fluid logo-width " alt="Brand Logo " /></a>
            <button class="navbar-toggler " type="button " data-toggle="collapse " data-target="#navbarsExampleDefault " aria-controls="navbarsExampleDefault " aria-expanded="false " aria-label="Toggle navigation ">
        <span class="navbar-toggler-icon "></span>
      </button>

            <div class="collapse navbar-collapse " id="navbarsExampleDefault ">
                <ul class="navbar-nav mr-auto " id="Tnavlist ">

                </ul>
                <ul class="float-right " id="profileContainer">
                   
                </ul>

            </div>
        </nav>


    </header>
    <div class="container p-4">
      <div class="row justify-content-center mb-2">
          <div class="">
              <h3 class="card-title">Referrals</h3>
          </div>
      </div>
      <div class="row  align-items-center p-2" id="memdropdown">
            <div class="col-6 ">
                <div class="row justify-content-between">
                    <div class="col-6">
                        <select class="form-control" id="options">
                            
                        </select>
                    </div>
                    
                </div>
            </div>
        </div>
      <div class="row" id="mainsection">
            
          <div class="col ">
            
            <div class="row justify-content-between align-items-center p-2">
                <div class="col-6">
                    <h4>In Bound Referrals</h4>
                </div>
                
            </div>
            <div class="row in">
                <div class="col">
                    <div class="card stat pt-3 pl-3 pr-3 pb-1 text-center">
                        <h6>Total</h6>
                        <h3>0</h3>
                    </div>
                </div>
                <div class="col">
                    <div class="card  stat pt-3 pl-3 pr-3 pb-1 text-center">
                        <h6>Done</h6>
                        <h3>0</h3>
                    </div>
                </div>
                <div class="col">
                    <div class="card stat pt-3 pb-1 pl-2 pr-2 text-center">
                        <h6>Not Done</h6>
                        <h3>0</h3>
                    </div>
                </div>
                <div class="col">
                    <div class="card stat pt-3 pb-1 pl-2 pr-2 text-center">
                        <h6>In Progress</h6>
                        <h3>0</h3>
                    </div>
                </div>
                
            
        
             </div>
             <div class="row">
                 <div class="col inbound">
                     
                 </div>
             </div>
            
          </div>
          <div class="col">
            <div class="row justify-content-between align-items-center p-2">
                <div class="col-6">
                    <h4>Out Bound Refrrals</h4>
                </div>
                <div class="col-4 text-right">
                    <a href="./refferalForm.html" class="btn btn-primary text-white" type="button">
                        Create New Referral
                    </a>
                </div>
            </div>
            <div class="row out">
                <div class="col">
                    <div class="card stat pt-3 pl-3 pr-3 pb-1 text-center">
                        <h6>Total</h6>
                        <h3>0</h3>
                    </div>
                </div>
                <div class="col">
                    <div class="card stat pt-3 pl-3 pr-3 pb-1 text-center">
                        <h6>Done</h6>
                        <h3>0</h3>
                    </div>
                </div>
                <div class="col">
                    <div class="card stat pt-3 pb-1 pl-2 pr-2 text-center">
                        <h6>Not Done</h6>
                        <h3>0</h3>
                    </div>
                </div>
                <div class="col">
                    <div class="card stat pt-3 pb-1 pl-2 pr-2 text-center">
                        <h6>In Progress</h6>
                        <h3>0</h3>
                    </div>
                </div>
            
        
             </div>
             <div class="row">
                 <div class="col outbound">
                     
                 </div>
             </div>

             </div>
          </div>
          
      </div>
    </div>
    <script src="../../js/jquery-2.2.4.min.js "></script>

    <script src="../../js/headroom.js "></script>

    <script src="../../js/popper.min.js "></script>

    <script src="../../js/bootstrap.min.js "></script>

    <script src="../../js/plugins.js "></script>

    <script src="../../js/active.js "></script>

    <script src="../../js/jquery.mobile.custom.min.js "></script>

    <script src="../../js/main.js "></script>

    <script src="../../app-assets/vendors/js/vendors.min.js "></script>
    <script src="../../app-assets/fonts/LivIconsEvo/js/LivIconsEvo.tools.js "></script>
    <script src="../../app-assets/fonts/LivIconsEvo/js/LivIconsEvo.defaults.js "></script>
    <script src="../../app-assets/fonts/LivIconsEvo/js/LivIconsEvo.min.js "></script>

    <script src="../../app-assets/vendors/js/ui/jquery.sticky.js "></script>

    <script src="../../app-assets/js/scripts/configs/horizontal-menu.js "></script>
    <script src="../../app-assets/js/core/app-menu.js "></script>
    <script src="../../app-assets/js/core/app.js "></script>
    <script src="../../app-assets/js/scripts/components.js "></script>
    <script src="../../app-assets/js/scripts/footer.js "></script>
    <script src="../../js/globalFuntions.js"></script>
    





</body>

</body>
<script>
    var myHeaders = new Headers();
    var userData = {};
   
    function auth(){        
        var authRequestOptions = {
        method : "POST",
        redirect : "follow",
        headers : myHeaders,
        body : ""
        }
        fetch("../../ws/auth.php",authRequestOptions)
        .then(response => response.json())
        .then(result => {
        console.log(result);
        if(result.status === "Not Logged In"){
            //redirect to login screen
            window.open("./login.html","_self");
        }else{
                userData = result;
                if(userData.admin == "1"){
                    loadMembers();
                }else{
                    var  memdropdown = document.getElementById('memdropdown');
                    memdropdown.innerHTML = "";
                }
                loadProfile();
                loadNavItems();
                getInboundReferrals(userData.memberId);
                getOutBoundReferrals(userData.memberId);
        }
        })
        .catch(error =>{console.log(error);});
    }
    function loadProfile(){
        console.log(userData);
        var profileContainer = document.getElementById('profileContainer');
        if(userData.photo === ""){
            if(userData.gender === "Male")
                userData.photo = "../../images/emptystates/male.png";
            else
                userData.photo = "../../images/emptystates/female.png";
        }
        profileContainer.innerHTML = `<li class="dropdown dropdown-user nav-item float-right">
                        <a class="dropdown-toggle nav-link dropdown-user-link" href="javascript:void(0);" data-toggle="dropdown" aria-expanded="false">
                          <div class="user-nav d-sm-flex d-none">
                            <span class="user-name text-bold-600" style="color: #fff;">`+userData.name+`</span>
                            
                          </div>
                          <span>
                            <img class="round" src="`+userData.photo+`" alt="avatar" height="40" width="40">
                          </span>
                        </a>
                        <div class="dropdown-menu dropdown-menu-right">
                          <a class="dropdown-item" href="javascript:void(0);">
                            <i class="bx bx-power-off mr-50"></i>
                            <span onclick="logOut()"> Logout</span>
                          </a>
                        </div>
                      </li>`;
    }
    function loadNavItems(){
        var rawMenu = "{\"load\":\"loadbyparent\",\"id\":\"Menu\"} ";

        var requestOptionsMenu = {
        method: 'POST',
        headers: myHeaders,
        redirect: 'follow',
        body : rawMenu
        };
        fetch("../../ws/Accessconfig.php ", requestOptionsMenu)
        .then(response => response.json())
        .then(result => {
            const navData =  result;
            
            var navhtml = '';
            for (var i in navData) {
                    console.log(navData[i].urlredirection);
                    // if(navData[i].urlredirection === ""){
                    //     navData[i].urlredirection = "#";
                    // }
                    if(navData[i].status == "0")
                        continue;
                    if(userData.admin == "0" && navData[i].ContentName == "Admin")
                        continue;
                    navhtml = navhtml + `<li class="nav-item active">
                                <a class="nav-link " href="`+navData[i].urlredirection+`">` + navData[i].ContentName + `</a>
                            </li>`;
            }
            
            
            document.getElementById("Tnavlist ").innerHTML = navhtml;
        })
        .catch(error => console.log('error', error));
    }
    function loadMembers(){
        var memberdData = {
            load : "loadallMemdata"
        }
        memberdData = JSON.stringify(memberdData);
        var memeberRequestOptions = {
            method : "POST",
            redirect : "follow",
            headers : myHeaders,
            body : memberdData
        }
        fetch("../../ws/Memberprofile.php",memeberRequestOptions)
        .then(response => response.json())
        .then(result => {
            var options = document.getElementById('options');
            console.log(result);
            if(Array.isArray(result)){
                var optionHtml = "";
                result.forEach((member)=>{
                    optionHtml = optionHtml + `<option value="`+member.userid+`">`+member.Name+`</option>`;
                })
                options.innerHTML = optionHtml;
            }
        })
        .then(()=>{
            //target search button
            var search = document.getElementById('options');
            search.addEventListener('change', ()=>{
                //get select option value
                var option = document.getElementById('options');
                var id = option.value;
                //call inbound and outbound for the value
                getInboundReferrals(id);
                getOutBoundReferrals(id);
            }) 
        })
        .catch(error =>{console.log(error);});
    }
    function logOut(){
        console.log('logout intiated');
 
        var logoutRequestOptions = {
            method : "POST",
            redirect : "follow",
            headers  : myHeaders,
            body : ""
        };
        fetch("../../ws/logout.php",logoutRequestOptions)
        .then(response => response.json())
        .then(result => {
            console.log(result);
            //redirect to home page
            window.open("http://localhost/sea_dev/ui/","_self");
            })
        .catch(error =>{
            console.log(error);
            alert("There was an error loggin you out Please try again")
            });
    }
    async function empty(section){
        section.innerHTML = "";
        var template = document.createElement('div');
        template.innerHTML = `<div class="row">
                                <div class="col-8">
                                    <div class="rowjustify-content-center">
                                        <img src="#" id="emptyImage" alt="">
                                    </div>
                                    <div class="row justify-content-center">
                                        <h4 >No Refferals</h4>
                                    </div>
                                </div>
                            </div>`;
        template = await emptyState(template,"Refferals");
        section.appendChild(template);
    }
    function getInboundReferrals(id){
        var inSection = document.querySelector('.inbound');
        inSection.innerHTML = "";
        var body = {
            load : "loadinbound",
            id : id
        }
        console.log(body);
        body = JSON.stringify(body);
        var requestOptions = {
            method : "POST",
            redirect : "follow",
            headers : myHeaders,
            body : body
        }
        fetch("../../ws/refferals.php",requestOptions)
        .then(response => response.json())
        .then(result => {
            console.log(result);
            var count = {
                "Total" : 0,
                "Done" : 0,
                "Not Done" : 0,
                "In Progress" : 0
            }
            if(Array.isArray(result)){
                count.Total = result.length;
                result.forEach(item=>{
                    count[item.status]++;
                    var card = document.createElement('div');
                    card.innerHTML= `<div class="col">
                    <div class="card">
                        <div class="row card-body justify-content-between align-items-center">
                            <div class="col-md-3 text-left">
                                `+item.contactname+`
                            </div>
                            <div class="col text-center">
                                <button type="button" class="btn btn-secondary">`+item.status+`</button>
                            </div>
                            <div class="col-md-3 text-center">
                                RS `+item.finalamnt+`
                            </div>
                            <div class="col text-center">
                                data
                            </div>
                            <div class="col text-right">
                                <a href="./refferalForm.html?id=`+item.id+`&action=update">
                                    <span class="material-icons">
                                        edit
                                    </span>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>`;
                inSection.appendChild(card.firstChild);
                })
                //show data
            }else{
                empty(inSection);
            }
            return count;
        })
        .then(count =>{
            console.log(count);
            //get the cards and add values to them
            var inSection = document.querySelector('.in');
            var cards = inSection.querySelectorAll('.stat');
            cards = Array.from(cards);
            cards.forEach(card=>{
                var head = card.firstElementChild;
                head.nextElementSibling.textContent = count[head.textContent];
                card.addEventListener('click',()=>{
                    // alert(head.textContent);
                    //filter refferals
                })
            })
        })
        .catch(error =>{console.log(error);});
    }
    function getOutBoundReferrals(id){
        var outSection = document.querySelector('.outbound');
        outSection.innerHTML = "";
        var body = {
            load : "loadoutbound",
            id : id
        }
        console.log(body);
        body = JSON.stringify(body);
        var requestOptions = {
            method : "POST",
            redirect : "follow",
            headers : myHeaders,
            body : body
        }
        fetch("../../ws/refferals.php",requestOptions)
        .then(response => response.json())
        .then(result => {
            console.log(result);
            var count = {
                "Total" : 0,
                "Done" : 0,
                "Not Done" : 0,
                "In Progress" : 0
            }
            if(Array.isArray(result)){
                count.Total = result.length;
                //display them
                result.forEach(item =>{
                    count[item.status]++;
                    var card = document.createElement('div');
                    card.innerHTML= `<div class="col">
                            <div class="card">
                                <div class="row card-body justify-content-between align-items-center">
                                    <div class="col-md-3 text-left">
                                        `+item.contactname+`
                                    </div>
                                    <div class="col text-center">
                                        <button type="button" class="btn btn-secondary">`+item.status+`</button>
                                    </div>
                                    <div class="col-md-4 text-center">
                                        RS `+item.finalamnt+`
                                    </div>
                                    <div class="col text-center">
                                        data
                                    </div>
                                    <div class="col text-right">
                                        
                                    </div>
                                </div>
                            </div>
                        </div>`;
                    outSection.appendChild(card.firstChild);
                })
            }else{
                empty(outSection);    
            }
            return count;
        })
        .then((count)=>{
            console.log(count);
            //get the cards and add values to them
            var outSection = document.querySelector('.out');
            var cards = outSection.querySelectorAll('.stat');
            cards = Array.from(cards);
            cards.forEach(card=>{
                var head = card.firstElementChild;
                head.nextElementSibling.textContent = count[head.textContent];
                card.addEventListener('click',()=>{
                    // alert(head.textContent);
                    //filter refferals
                })
            })
        })
        .catch(error =>{console.log(error);});
    } 
    function showRefferals(section, refferals){

    }
    auth();
    // loadNavItems();
</script>

</html>
