<!DOCTYPE html>
<!-- saved from url=(0128)https://www.pixinvent.com/demo/frest-clean-bootstrap-admin-dashboard-template/html/ltr/horizontal-menu-template/form-layout.html -->
<html class="loaded" lang="en" data-textdirection="ltr">
<!-- BEGIN: Head-->

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0">
    <meta name="description" content="Frest admin is super flexible, powerful, clean &amp; modern responsive bootstrap 4 admin template with unlimited possibilities.">
    <meta name="keywords" content="admin template, Frest admin template, dashboard template, flat admin template, responsive admin template, web app">
    <meta name="author" content="PIXINVENT">
    <title>Dashboard</title>
    <link rel="apple-touch-icon" href="https://www.pixinvent.com/demo/frest-clean-bootstrap-admin-dashboard-template/app-assets/images/ico/apple-icon-120.png">
    <link rel="shortcut icon" type="image/x-icon" href="https://www.pixinvent.com/demo/frest-clean-bootstrap-admin-dashboard-template/app-assets/images/ico/favicon.ico">

    <!-- BEGIN: Vendor CSS-->
    <link rel="stylesheet " type="text/css " href="../../css/vendors.min.css ">
    <!-- END: Vendor CSS-->

    <!-- BEGIN: Theme CSS-->
    <link rel="stylesheet " type="text/css " href="../../css/bootstrap.min.css ">
    <link rel="stylesheet " type="text/css " href="../../css/bootstrap-extended.min.css">
    <link rel="stylesheet " type="text/css " href="../../css/colors.min.css ">
    <link rel="stylesheet " type="text/css " href="../../css/components.min.css ">
    <link rel="stylesheet " type="text/css " href="../../css/dark-layout.min.css ">
    <link rel="stylesheet " type="text/css " href="../../css/semi-dark-layout.min.css ">
    <!-- END: Theme CSS-->

    <!-- BEGIN: Page CSS-->
    <link rel="stylesheet " type="text/css " href="../../css/horizontal-menu.min.css ">
    <!-- END: Page CSS-->

    <!-- BEGIN: Custom CSS-->
    <!-- END: Custom CSS-->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons " rel="stylesheet ">

    <link rel="apple-touch-icon " href="../../app-assets/images/ico/apple-icon-120.png ">
    <link rel="shortcut icon " type="image/x-icon " href="../../app-assets/images/ico/favicon.ico ">
    <link href="https://fonts.googleapis.com/css?family=Rubik:300,400,500,600%7CIBM+Plex+Sans:300,400,500,600,700 " rel="stylesheet ">


    <link rel="stylesheet " type="text/css " href="../../app-assets/vendors/css/vendors.min.css ">
    <link rel="stylesheet " type="text/css " href="../../app-assets/vendors/css/charts/apexcharts.css ">
    <link rel="stylesheet " type="text/css " href="../../app-assets/vendors/css/extensions/swiper.min.css ">
    <link rel="stylesheet " href="../../css/font-awesome-4.7.0/css/font-awesome.min.css ">
    <link rel="stylesheet" href="../../app-assets/vendors/css/forms/select/select2.css">


    <link rel="stylesheet " type="text/css " href="../../app-assets/css/bootstrap.css ">
    <link rel="stylesheet " type="text/css " href="../../app-assets/css/bootstrap-extended.css ">
    <link rel="stylesheet " type="text/css " href="../../app-assets/css/colors.css ">
    <link rel="stylesheet " type="text/css " href="../../app-assets/css/components.css ">


    <link rel="stylesheet " type="text/css " href="../../app-assets/css/core/menu/menu-types/horizontal-menu.css ">
    <link rel="stylesheet " type="text/css " href="../../app-assets/css/pages/dashboard-ecommerce.css ">





    <link rel="icon " href="../../img/core-img/favicon.png " />


    <link rel="stylesheet " href="../../css/responsive.css " />
    <link href="../../css/custom.css"rel=" stylesheet ">

    <script src="../../js/modernizr.js "></script>




</head>
<!-- END: Head-->

<style>
    body {
        font-family: Arial, Helvetica, sans-serif;
    }
    .row{
        margin: 0 ;
    }
    /* The Modal (background) */
    
    .modal {
        display: none;
        /* Hidden by default */
        position: fixed;
        /* Stay in place */
        z-index: 1;
        /* Sit on top */
        padding-top: 100px;
        /* Location of the box */
        left: 0;
        top: 0;
        width: 100%;
        /* Full width */
        height: 100%;
        /* Full height */
        /* Enable scroll if needed */
        background-color: rgb(0, 0, 0);
        /* Fallback color */
        background-color: rgba(0, 0, 0, 0.4);
        /* Black w/ opacity */
    }
    /* Modal Content */
    
    .modal-content {
        background-color: #fefefe;
        margin: auto;
        padding: 20px;
        border: 1px solid #888;
        width: 80%;
        height: 100%;
    }
    /* The Close Button */
    
    .close {
        color: #aaaaaa;
        float: right;
        font-size: 28px;
        font-weight: bold;
    }
    
    .close:hover,
    .close:focus {
        color: #000;
        text-decoration: none;
        cursor: pointer;
    }
    #addForm{
        display: none;
    }
    #list-view{
        display: none;
    }
    .material-icons.active{
        color: #5a8dee;
    }
    .material-icons.inactive{
        color : #c7c7c7;
    }
</style>

<!-- BEGIN: Body-->

<body style="background-color: #d4d4d473;">

        <div id="navbar-container">

        </div>
    
        <div class="container " >
            <div class="row  justify-content-center align-items-center col-12" style="margin-top: 10%;">
                <div class="col-md-6">
                    <div class="row mb-4 card onlyAdmin">
                        <div class="row card-body pb-1 justify-content-between">
                            <div class="col-6 form-group">
                                <select class="select2 form-control select2-hidden-accessible"  id="oppurtunities" data-select2-id="1" tabindex="-1" aria-hidden="true">
                                   
                                </select>
                            </div>
                            <div class="col-1 text-center">
                                <a href="javascript:void(0)" onclick="downloadData('oppurtunities',this)">
                                    <div class="livicon-evo" data-options="
                                    name: cloud-download.svg; 
                                    size: 3rem   
                                    "></div>
                                </a>
                            </div>
                        </div>
                    </div>
                    <div class="row  ">
                        <div class="col card">
                            <div class="row card-header justify-content-between" style="margin-top : -8%">
                                <div class="col">
                                    <div class="row">
                                        <div class="col">
                                            <a href="./oppurtunityView.html">
                                                <div class="livicon-evo" data-options="
                                                name: plus-alt.svg; 
                                                size: 3rem; 
                                                "></div>
                                            </a>
                                        </div>
                                        <div class="col">
                                            <a href="./oppurtunitiesForm.html">
                                                <div class="livicon-evo" data-options="
                                                name: thumbnails-big.svg; 
                                                size: 3rem;
                                                "></div></a>
                                        </div>
                                    </div>
                                </div>
                                <div class="col text-right ">
                                    <div class="row chip chip-primary">
                                        <span class="chip-text text-white" style="font-size: 1.2rem; padding: 0.4rem;">
                                            Oppurtunities
                                        </span>
                                    </div>
                                </div>
                            </div>
                            <div class="row card-body p-0 pb-3">
                                <div class="col p-1 m-1 badge-circle-light-danger">
                                    <div class="row justify-content-center">
                                        <h4 id="myopp">
                                            0
                                        </h4>
                                    </div>
                                    <div class="row justify-content-center">
                                        <h4>
                                            My Oppurtunities
                                        </h4>
                                    </div>
                                </div>
                                <div class="col m-1 p-1 badge-circle-light-success" >
                                    <div class="row justify-content-center">
                                        <h4 id="allopp">
                                            0
                                        </h4>
                                    </div>
                                    <div class="row justify-content-center">
                                        <h4>
                                            All Oppurtunities
                                        </h4>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="row mb-4 card onlyAdmin">
                        <div class="row card-body pb-1 justify-content-between">
                            <div class="col-6 form-group">
                                <select class="select2 form-control select2-hidden-accessible" id="refferals" data-select2-id="2" tabindex="-1" aria-hidden="true">
                                   
                                </select>
                            </div>
                            <div class="col-1 text-center">
                                <div class="col-1 text-center">
                                    <a href="javascript:void(0)" onclick="downloadData('refferals',this)">
                                        <div class="livicon-evo" data-options="
                                        name: cloud-download.svg; 
                                        size: 3rem   
                                        "></div>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row ">
                        <div class="col card">
                            <div class="row card-header justify-content-between" style="margin-top : -8%">
                                <div class="col">
                                    <div class="row">
                                        <div class="col">
                                            <a href="./refferalForm.html">
                                                <div class="livicon-evo" data-options="
                                                name: plus-alt.svg; 
                                                size: 3rem; 
                                                "></div>
                                            </a>
                                        </div>
                                        <div class="col">
                                            <a href="./referalview.html">
                                                <div class="livicon-evo" data-options="
                                                name: thumbnails-big.svg; 
                                                size: 3rem;
                                                "></div></a>
                                        </div>
                                    </div>
                                </div>
                                <div class="col text-right ">
                                    <div class="row chip chip-primary">
                                        <span class="chip-text text-white" style="font-size: 1.2rem; padding: 0.4rem;">
                                            Referrals
                                        </span>
                                    </div>
                                </div>
                            </div>
                            <div class="row card-body p-0 pb-3">
                                <div class="col p-1 m-1 badge-circle-light-danger" >
                                    <div class="row justify-content-center" >
                                        <h4 id="inref">
                                            0
                                        </h4>
                                    </div>
                                    <div class="row justify-content-center">
                                        <h4>
                                            In Bound
                                        </h4>
                                    </div>
                                </div>
                                <div class="col m-1 p-1 badge-circle-light-success" >
                                    <div class="row justify-content-center">
                                        <h4 id="outref">
                                            0
                                        </h4>
                                    </div>
                                    <div class="row justify-content-center">
                                        <h4>
                                            Out Bound
                                        </h4>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
               
                
            </div>
        </div>
   
    <script src="../../js/jquery-2.2.4.min.js"></script>

    <script src="../../js/headroom.js "></script>

    <script src="../../js/popper.min.js "></script>

    <script src="../../js/bootstrap.min.js "></script>

    <script src="../../js/plugins.js "></script>

    <script src="../../js/active.js"></script>

    <script src="../../js/jquery.mobile.custom.min.js "></script>

    <script src="../../js/main.js "></script>

    <script src="../../app-assets/vendors/js/vendors.min.js"></script>
    <script src="../../app-assets/fonts/LivIconsEvo/js/LivIconsEvo.tools.js "></script>
    <script src="../../app-assets/fonts/LivIconsEvo/js/LivIconsEvo.defaults.js "></script>
    <script src="../../app-assets/fonts/LivIconsEvo/js/LivIconsEvo.min.js "></script>

    <script src="../../app-assets/vendors/js/ui/jquery.sticky.js "></script>
    <script src="../../app-assets/vendors/js/forms/select/select2.full.min.js"></script>
    <script src="../../app-assets/js/scripts/configs/horizontal-menu.js "></script>
    <script src="../../app-assets/js/core/app-menu.js "></script>
    <script src="../../app-assets/js/core/app.js "></script>
    <script src="../../app-assets/js/scripts/components.js "></script>
    <script src="../../app-assets/js/scripts/footer.js "></script>
    <script src="../../js/globalFuntions.js"></script>
    <script src="../../app-assets/js/scripts/forms/select/form-select2.js"></script>    
    <script>
        $('#navbar-container').load('../components/navbar.html');
        $(document).ready(function() {
            var year = new Date().getFullYear();
            $(".year").text(year);
            // Select all links with hashes
            $('a[href*="#"]')
                // Remove links that don't actually link to anything
                .not('[href="#"]')
                .not('[href="#0"]')
                .click(function(event) {
                    // On-page links
                    if (
                        location.pathname.replace(/^\//, "") == this.pathname.replace(/^\//, "") &&
                        location.hostname == this.hostname
                    ) {
                        // Figure out element to scroll to
                        var target = $(this.hash);
                        target = target.length ? target : $("[name=" + this.hash.slice(1) + "]");
                        // Does a scroll target exist?
                        if (target.length) {
                            // Only prevent default if animation is actually gonna happen
                            event.preventDefault();
                            $("html, body").animate({
                                    scrollTop: target.offset().top
                                },
                                1000,
                                function() {
                                    // Callback after animation
                                    // Must change focus!
                                    var $target = $(target);
                                    $target.focus();
                                    if ($target.is(":focus")) {
                                        // Checking if the target was focused
                                        return false;
                                    } else {
                                        $target.attr("tabindex", "-1"); // Adding tabindex for elements not focusable
                                        $target.focus(); // Set focus again
                                    }
                                }
                            );
                        }
                    }
                });
            // grab an element
            var myElement = document.querySelector("header");
            // construct an instance of Headroom, passing the element
            var headroom = new Headroom(myElement);
            // initialise
            headroom.init();
        });

        $(document).ready(function() {
            $('[data-toggle="tooltip"]').tooltip();
        });
    </script> 
<script>
    var myHeaders = new Headers();
    var userData = {};
    function loadData(){
        var authRequestOptions = {
        method : "POST",
        redirect : "follow",
        headers : myHeaders,
        body : ""
        }
        fetch("../../ws/auth.php",authRequestOptions)
        .then(response => response.json())
        .then(result => {
            console.log(result);
            userData = result;
            loadMembers();
            loadOppurtunityData(userData.memberId);
            loadRefferalData(userData.memberId);

        })
        .catch(error =>{console.log(error);});
    }  
    loadData();  
    function loadOnchange(){
        var $memberOptionsOne = $('#oppurtunities');
        $memberOptionsOne.on("select2:select",function(e){
            console.log(e.params.data.id);
            var id = e.params.data.id;
            loadOppurtunityData(id)
        });
        var $memberOptionsTwo = $('#refferals');
        $memberOptionsTwo.on("select2:select",function(e){
            id = e.params.data.id;
            console.log(e.params.data.id);
            loadRefferalData(id);
        });
        
    }
    function loadMembers(){
        var memberdData = {
            load : "loadallMemdata"
        }
        memberdData = JSON.stringify(memberdData);
        var memeberRequestOptions = {
            method : "POST",
            redirect : "follow",
            headers : myHeaders,
            body : memberdData
        }
        fetch("../../ws/Memberprofile.php",memeberRequestOptions)
        .then(response => response.json())
        .then(result => {
            var memberOptionsOne = document.getElementById('refferals');
            var memberOptionsTwo = document.getElementById('oppurtunities');
            console.log(result);
            if(Array.isArray(result)){
                var options = "";
                result.forEach((member)=>{
                    options = options + `<option value="`+member.userid+`">`+member.Name+`</option>`;
                })
                memberOptionsOne.innerHTML = options;
                memberOptionsTwo.innerHTML = options;
            }
            memberOptionsOne.value = userData.memberId;
            memberOptionsTwo.value = userData.memberId;
            loadOnchange();
        })
        .catch(error=>{console.log(error);});
    }
    auth();
     
    //load data of admin by default
    async function loadOppurtunityData(id){
        //load numbers
        //load all oppurtunties
        var a = await allOppurnities();
        var b = await myOppurtunities(id);
        //get elements and add data to it
        var myopp = document.getElementById('myopp');
        myopp.innerText = a;
        var allopp = document.getElementById('allopp');
        allopp.innerText = b;
    }
    async function loadRefferalData(id){
        //load numbre
        var a =await  inBoundRefferals(id);
        var b =await outBoundRefferals(id); 
        var inref = document.getElementById('inref');
        var outref = document.getElementById('outref');
        console.log(a+","+b);
        inref.innerText = a;
        outref.innerText = b;
    }
    async function allOppurnities(){
        var data = {
            load : "loadall"
        }
        data = JSON.stringify(data);
        var requestOption = { method: 'POST', headers: myHeaders,redirect: 'follow',body : data};
        try{
            var count = await fetch("../../ws/oppurtunities.php",requestOption).then(response => response.json())
            .then(result =>{
                console.log(result);
                if(Array.isArray(result)){
                    return result.length;
                }else{
                    return 0;
                }
            })
            return count;
        }
        catch(error){
            console.log(error);
            return 0;
        }
    }
    async function myOppurtunities(id){
        var data = {
            load : "loadinbound",
            id
        }
        data = JSON.stringify(data);
        var requestOption = { method: 'POST', headers: myHeaders,redirect: 'follow',body : data};
        try{
            var count = await fetch("../../ws/oppurtunities.php",requestOption).then(response => response.json())
            .then(result => {
                console.log(result);
                if(Array.isArray(result)){
                    return result.length;
                }else{
                    return 0;
                }
            });
            return count;
        }
        catch(error){
            console.log(error);
            return 0;
        }
    }
    async function inBoundRefferals(id){
        var data = {
            load: "loadinbound",
            id : id
        }
        console.log(data);
        data = JSON.stringify(data);
        var requestOption = { method: 'POST', headers: myHeaders,redirect: 'follow',body : data};
        try{
            var count = await fetch("../../ws/refferals.php",requestOption).then(response => response.json())
            .then(result =>{
                if(Array.isArray(result)){
                    return result.length;
                }else{
                    return 0;
                }
            })
            return count;
        }
        catch(error){
            console.log(error);
            return 0;
        }
    }
    async function outBoundRefferals(id){
        var data = {
            load: "loadoutbound",
            id : id
        }
        data = JSON.stringify(data);
        var requestOption = { method: 'POST', headers: myHeaders,redirect: 'follow',body : data};
        try{
            var count = await fetch("../../ws/refferals.php",requestOption).then(response => response.json())
            .then(result =>{
                if(Array.isArray(result)){
                    return result.length;
                }else{
                    return 0;
                }
            })
            return count;
        }
        catch(error){
            console.log(error);
            return 0;
        }
    }
    function downloadData(name,el){
        console.log(name);
        //according to it get data from referral or oppurtunity
        var id = document.getElementById(name).value;
        var data = {
            load : "loadall",
            id : id
        }
        console.log(data);
        data = JSON.stringify(data);
        var requestOption = { method: 'POST', headers: myHeaders,redirect: 'follow',body : data};
        fetch(`../../ws/`+name+`.php`,requestOption)
        .then(response => response.json())
        .then(result => {
            console.log(result);
            var dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(result));
            var downloadAnchorNode = document.createElement('a');
            downloadAnchorNode.setAttribute("href",     dataStr);
            downloadAnchorNode.setAttribute("download", name + "_"+ id +".json");
            document.body.appendChild(downloadAnchorNode); // required for firefox
            downloadAnchorNode.click();
            downloadAnchorNode.remove();
        })
        .catch(error =>{console.log(error);});
        //get member id from the drop down
    }
</script>
</body>
</html>
