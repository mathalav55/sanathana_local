<!DOCTYPE html>
<html lang="en">

<head>

  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimal-ui">
  <meta name="description"
    content="Frest admin is super flexible, powerful, clean &amp; modern responsive bootstrap 4 admin template with unlimited possibilities.">
  <meta name="keywords"
    content="admin template, Frest admin template, dashboard template, flat admin template, responsive admin template, web app">
  <meta name="author" content="PIXINVENT">
  <title>Member Form</title>
  <link rel="apple-touch-icon" href="../../app-assets/images/ico/apple-icon-120.png">
  <link rel="shortcut icon" type="image/x-icon" href="../../app-assets/images/ico/favicon.ico">
  <link href="https://fonts.googleapis.com/css?family=Rubik:300,400,500,600%7CIBM+Plex+Sans:300,400,500,600,700"
    rel="stylesheet">


  <link rel="stylesheet" type="text/css" href="../../app-assets/vendors/css/vendors.min.css">
  <link rel="stylesheet" type="text/css" href="../../app-assets/vendors/css/charts/apexcharts.css">
  <link rel="stylesheet" type="text/css" href="../../app-assets/vendors/css/extensions/swiper.min.css">
  <link rel="stylesheet" href="../../css/font-awesome-4.7.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="../../app-assets/vendors/css/forms/select/select2.css">



  <link rel="stylesheet" type="text/css" href="../../app-assets/css/bootstrap.css">
  <link rel="stylesheet" type="text/css" href="../../app-assets/css/bootstrap-extended.css">
  <link rel="stylesheet" type="text/css" href="../../app-assets/css/colors.css">
  <link rel="stylesheet" type="text/css" href="../../app-assets/css/components.css">


  <link rel="stylesheet" type="text/css" href="../../app-assets/css/core/menu/menu-types/horizontal-menu.css">
  <link rel="stylesheet" type="text/css" href="../../app-assets/css/pages/dashboard-ecommerce.css">





  <link rel="icon" href="img/core-img/favicon.png" />


  <link rel="stylesheet" href="../../css/responsive.css" />

  <link rel="stylesheet" type="text/css" href="../../css/custom.css" />


  <script src="../../js/modernizr.js"></script>
  <!-- The core Firebase JS SDK is always required and must be listed first -->
  <script src="https://www.gstatic.com/firebasejs/8.6.5/firebase-app.js"></script>

  <!-- TODO: Add SDKs for Firebase products that you want to use
      https://firebase.google.com/docs/web/setup#available-libraries -->
  <script src="https://www.gstatic.com/firebasejs/8.6.5/firebase-analytics.js"></script>

  <script>
      // Your web app's Firebase configuration
      // For Firebase JS SDK v7.20.0 and later, measurementId is optional
      var firebaseConfig = {
          apiKey: "AIzaSyAaX52IZbaEg3gYnMeHRWh5bi-pLEw2-c4",
          authDomain: "sanathana-1558e.firebaseapp.com",
          projectId: "sanathana-1558e",
          storageBucket: "sanathana-1558e.appspot.com",
          messagingSenderId: "69696836774",
          appId: "1:69696836774:web:4edf184e3cfe3608679067",
          measurementId: "G-DRHZRFBMLY"
      };
      // Initialize Firebase
      firebase.initializeApp(firebaseConfig);
      firebase.analytics();
  </script>
  <style>
    .hide{
      display: none;
    }
    .row{
      margin: 0 !important;
    }
  </style>

</head>

<body >


  <div id="navbar-container">

  </div>
<div class=" row p-1" style="position: fixed;bottom:0;z-index: 999999;">
  <div class="col toast-container">
      
  </div>
</div>
  <div class="container bg-grey" style="padding-top: 7%;" >
    <div class="row mt-1" id="memberForm_one">
      <div class="col-8">
        <form class="form form-horizontal">
          <div class="form-body">
            <div class="row">
              <div class="col-12">
                <div class="card">
                  <div class="card-header bg-primary">
                    <h4 class="card-title text-white">Basic Profile</h4>
                  </div>
                  <div class="card-body">
                    <div class="row">
                      <div class="col-md-4">
                        <label for="name" class="required">Mobile Number</label>
                      </div>
                      <div class="col-md-8">
                        <div class="input-group form-group">
                          <div class="input-group-prepend">
                            <select class="select2" id="countryCode" >
                                
  
                            </select>
                          </div>
                          <input type="number" id="phoneNumber" class="form-control" placeholder="Mobile Number">
                        </div>
                      </div>
                      <div class="col-md-4">
                        <label for="name" class="required">Name</label>
                      </div>
                      <div class="col-md-8 form-group">
                        <input type="text" id="name" class="form-control" name="fname" placeholder="Name" required>
                      </div>

                      <div class="col-md-4">
                        <label for="surname">Surname</label>
                      </div>
                      <div class="col-md-8 form-group">
                        <input type="text" id="surname" class="form-control" name="fname" placeholder="Surname">
                      </div>
                     
                      <div class="col-md-4">
                        <label for="dob" class="required">DOB</label>
                      </div>
                      <div class="col-md-8 form-group">
                        <input type="date" id="dob" class="form-control format-picker picker__input picker__input--active"
                          placeholder="DOB">
                      </div>

                      <div class="col-md-4">
                        <label class="">Gender</label>
                      </div>
                      <div class="col-md-8 form-group">
                        <fieldset class="form-group">
                          <select class="form-control" id="gender">
                            <option>Male</option>
                            <option>Female</option>
                            <option>Other</option>
                          </select>
                        </fieldset>
                      </div>

                      <div class="col-md-4">
                        <label for="gotram">Gotram</label>
                      </div>
                      <div class="col-md-8 form-group">
                        <input type="text" id="gotram" class="form-control" name="fname" placeholder="Gothram">
                      </div>

                      <div class="col-md-4">
                        <label for="memberPhoto">member photo</label>
                      </div>
                      <div class="col-md-8 form-group">
                        <div class="input-group">
                          <input  type="file" class="form-control" id="memberPhoto">
                          <label class="input-group-text" for="inputGroupFile02">Upload</label>
                        </div>

                      </div>

                      <div class="col-md-4">
                        <label for="referredBy">referred by</label>
                      </div>
                      <div class="col-md-8 form-group">
                        <input type="text" id="referredBy" class="form-control" name="contact" placeholder="Refreed By">
                      </div> 

                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="col-12">
              <div class="form form-horizontal">
                <div class="form-body">
                  <div class="row">
                    <div class="col-12">
                      <div class="card">
                        <div class="card-header bg-primary">
                          <h4 class="card-title text-white text-right">Chapter / Group / Category</h4>
                        </div>
                        <div class="card-body">
                          <h4>Primary Chapter</h4>
                          <div class="row">
                            <div class="col-md-8 form-group">
                              <ul class="list-unstyled mb-0" id="chapterRadios">
                                <li class="d-inline-block mr-2 mb-1">
                                  <fieldset>
                                    <div class="radio">
                                      <input type="radio" class="radio-input" id="radio1">
                                      <label for="radio1" name="chapterRadios">no data</label>
                                    </div>
                                  </fieldset>
                                </li>  
                               </ul>
                            </div>
                          </div>
                        </div>
                        <div class="card-body">
                          <h4>Secondary Chapter</h4>
                          <div class="row"> 
                            <div class="col-md-8 form-group">
                              <ul class="list-unstyled mb-0" id="chapterCheckBoxes">
                                <li class="d-inline-block mr-2 mb-1">
                                  <fieldset>
                                    <div class="checkbox">
                                      <input type="checkbox" class="checkbox-input" id="checkbox1" >
                                      <label for="checkbox1">no data</label>
                                    </div>
                                  </fieldset>
                                </li>
                               </ul>
                            </div>
                          </div>
                        </div>
                        <div class="card-body">
                          <h4>Group</h4>
                          <div class="row">
                            <div class="col-md-8 form-group">
                              <ul class="list-unstyled mb-0" id="groupCheckBoxes">
                                <li class="d-inline-block mr-2 mb-1">
                                  <fieldset>
                                    <div class="checkbox">
                                      <input type="checkbox" class="checkbox-input" id="checkbox1">
                                      <label for="checkbox1">no data</label>
                                    </div>
                                  </fieldset>
                                </li>  
                               </ul>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>  
                </div>
              </div>
            </div>
            <div class="row ">
              <div class="col-md-12 mb-2 col-12  d-flex justify-content-end ">
                <button type="submit" class="btn btn-primary mr-1" id="saveBtnOne">Save </button>
                <button type="button" class="btn btn-warning" id="nextBtnOne" disabled>Next</button>
              </div>
            </div>
          </div>
        </form>
      </div>
      <div class="col-4">
        <div class="row">
          <div class="col-12">
            <div class="card">
              <div class="card-header bg-primary">
                <h4 class="card-title text-white">User Status</h4>
              </div>
              <div class="card-body">
                <form class="form form-horizontal">
                  <div class="form-body">
                    <div class="row">
                      <div class="col-12 form-group">
                        <ul class="list-unstyled mb-0">
                          <li class="d-inline-block mr-2 mb-1">
                            <fieldset>
                              <div class="radio">
                                <input type="radio" name="activeStatus" id="active" checked>
                                <label for="active">Active</label>
                              </div>
                            </fieldset>
                          </li>
                          <li class="d-inline-block mr-2 mb-1">
                            <fieldset>
                              <div class="radio">
                                <input type="radio" name="activeStatus" id="inactive">
                                <label for="inactive">Inactive</label>
                              </div>
                            </fieldset>
                          </li>
                        </ul>
                      </div>
                    </div>
                  </div>
                </form>
                <button class="btn btn-warning" onclick="resetPassword()">Reset Password</button>
              </div>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col-12">
            <div class="card">
              <div class="card-header bg-primary">
                <h4 class="card-title text-white">User Privilige</h4>
              </div>
              <div class="card-body">
                <form class="form form-horizontal">
                  
                        <ul class="list-unstyled mb-0">
                          <li class="d-inline-block mr-2 mb-1">
                            <fieldset>
                              <div class="radio">
                                <input type="radio" name="activeStatus" id="admin">
                                <label for="admin">Admin</label>
                              </div>
                            </fieldset>
                          </li>
                          <li class="d-inline-block mr-2 mb-1">
                            <fieldset>
                              <div class="radio">
                                <input type="radio" name="activeStatus" id="nonadmin" checked>
                                <label for="nonadmin">User</label>
                              </div>
                            </fieldset>
                          </li>
                        </ul>
                     
                </form>
              </div>
            </div>
          </div>
        </div>  
        <div class="row">
          <div class="col-12">
            <div class="card">
              <div class="card-header bg-primary">
                <h4 class="card-title text-white">Profile Image</h4>
              </div>
              <div class="card-body">
                <img src="" id="profilePreview" style="width: 5rem;" alt="">
              </div>
            </div>
          </div>
        </div> 
      </div>
      
    </div>
    <!--testing area  -->
   
          
        
    <!-- testing area ends -->
  <!-- second tab -->
    <div class="row mt-1" id="memberForm_two">
      <div class="col-12">
          <div class="form-body">
            <div class="row">
              <div class="col-12">
                <div class="card">
                  <div class="card-header bg-primary">
                    <h4 class="card-title text-white text-right">Member Verticals</h4>
                  </div>
                  <div class="card-body">
                    <h4>Business Category</h4>
                    <div class="row">
                      <div class="col-md-8 form-group">
                        <ul class="list-unstyled mb-0" id="businessCategory">
                          <li class="d-inline-block mr-2 mb-1">
                            <fieldset>
                              <div class="checkbox">
                                <input type="checkbox" class="checkbox-input" id="businessCat" checked="">
                                <label for="businessCat">no data</label>
                              </div>
                            </fieldset>
                          </li>
                         </ul>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <!-- business form start -->
            <div  id="businessDetailsForm">
              
            </div>
            <!-- business form ends -->
          </div>
      </div>
      <div class="row">
        <div class="col-12 mb-2 d-flex justify-content-end ">
          <button type="submit" class="btn btn-primary mr-1 hide" id="previousBtn">Previous</button>
          <button type="submit" class="btn btn-primary mr-1" id="saveBtnTwo">Save</button>
          <button type="button" class="btn btn-warning" onclick="viewProfile()" id="viewProfileBtn" disabled>View Profile</button>
        </div>
      </div>
    </div>

    <!--  third form-->
    <div id="memberForm_three" class="row mt-1">
      <div class="col-12">
        <div class="form form-horizontal">
          <div class="form-body">
            <div class="row">
              <div class="col-12">
                <div class="card">
                  <div class="card-header bg-primary">
                    <h4 class="card-title text-white text-right">Chapter / Group / Category</h4>
                  </div>
                  <div class="card-body">
                    <h4>Primary Chapter</h4>
                    <div class="row">
                      <div class="col-md-8 form-group">
                        <ul class="list-unstyled mb-0" id="chapterRadios">
                          <li class="d-inline-block mr-2 mb-1">
                            <fieldset>
                              <div class="radio">
                                <input type="radio" class="radio-input" id="radio1">
                                <label for="radio1" name="chapterRadios">no data</label>
                              </div>
                            </fieldset>
                          </li>  
                         </ul>
                      </div>
                    </div>
                  </div>
                  <div class="card-body">
                    <h4>Secondary Chapter</h4>
                    <div class="row"> 
                      <div class="col-md-8 form-group">
                        <ul class="list-unstyled mb-0" id="chapterCheckBoxes">
                          <li class="d-inline-block mr-2 mb-1">
                            <fieldset>
                              <div class="checkbox">
                                <input type="checkbox" class="checkbox-input" id="checkbox1" >
                                <label for="checkbox1">no data</label>
                              </div>
                            </fieldset>
                          </li>
                         </ul>
                      </div>
                    </div>
                  </div>
                  <div class="card-body">
                    <h4>Group</h4>
                    <div class="row">
                      <div class="col-md-8 form-group">
                        <ul class="list-unstyled mb-0" id="groupCheckBoxes">
                          <li class="d-inline-block mr-2 mb-1">
                            <fieldset>
                              <div class="checkbox">
                                <input type="checkbox" class="checkbox-input" id="checkbox1">
                                <label for="checkbox1">no data</label>
                              </div>
                            </fieldset>
                          </li>  
                         </ul>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>  
          </div>
        </div>
      </div>
      
    </div>

  </div>
  <script src="../../js/jquery-2.2.4.min.js"></script>

  <script src="../../js/headroom.js"></script>

  <!-- <script src="../../js/popper.min.js"></script> -->

  <script src="../../js/bootstrap.min.js"></script>

  <script src="../../js/plugins.js"></script>

  <script src="../../js/active.js"></script>

  <script src="../../js/jquery.mobile.custom.min.js"></script>

  <script src="../../js/main.js"></script>

  <script src="../../app-assets/vendors/js/vendors.min.js"></script>
  <script src="../../app-assets/fonts/LivIconsEvo/js/LivIconsEvo.tools.js"></script>
  <script src="../../app-assets/fonts/LivIconsEvo/js/LivIconsEvo.defaults.js"></script>
  <script src="../../app-assets/fonts/LivIconsEvo/js/LivIconsEvo.min.js"></script>

  <script src="../../app-assets/vendors/js/ui/jquery.sticky.js"></script>
  <script src="../../app-assets/vendors/js/forms/repeater/jquery.repeater.min.js"></script>


  <script src="../../app-assets/js/scripts/configs/horizontal-menu.js"></script>
  <script src="../../app-assets/js/core/app-menu.js"></script>
  <script src="../../app-assets/js/core/app.js"></script>
  <script src="../../app-assets/js/scripts/components.js"></script>
  <script src="../../app-assets/js/scripts/footer.js"></script>
  <script src="../../app-assets/js/scripts/forms/form-repeater.min.js"></script>
  <script src="../../js/custom.js"></script>
  <script src="../../js/globalFuntions.js"></script>
  
  <script src="../../app-assets/vendors/js/forms/select/select2.full.min.js"></script>
  <script src="../../app-assets/js/scripts/forms/select/form-select2.js"></script> 
  <script>
    $('#navbar-container').load('../components/navbar.html');
    $(document).ready(function() {
        var year = new Date().getFullYear();
        $(".year").text(year);
        // Select all links with hashes
        // grab an element
        var myElement = document.querySelector("header");
        // construct an instance of Headroom, passing the element
        var headroom = new Headroom(myElement);
        // initialise
        headroom.init();
    });

    $(document).ready(function() {
        $('[data-toggle="tooltip"]').tooltip();
    });
</script> 
  <script>
    //fetch data from api
    var myHeaders = new Headers();
  // myHeaders.append("Content-Type ", "text/plain ");
  // myHeaders.append("Cookie ", "PHPSESSID=a147dbe2815c8b7145c6f2ca214f3716 ");
  auth("admin");
    //end fetch nav data from api
    
    //fetch data from url
    var action = "add";
    var updateMemberId = "";
    const params = (new URL(document.location)).searchParams;
    if(params.get('action')){
      action = params.get('action');
    }
    if(params.get('memberId')){
      updateMemberId = params.get('memberId');
    }

    var form1 = document.getElementById("memberForm_one");
    var form2 = document.getElementById("memberForm_two");
    var form3 = document.getElementById("memberForm_three");
    form3.classList.add("hide");//setting initial state
    form2.classList.add("hide");//setting initial state
    var saveBtnOne = document.getElementById("saveBtnOne");
    var nextBtnOne = document.getElementById("nextBtnOne");
    var nextBtnTwo = document.getElementById("nextBtnTwo")
    var saveBtnTwo = document.getElementById("saveBtnTwo");
    var saveBtnThree = document.getElementById("saveBtnThree");
    var previousBtn = document.getElementById("previousBtn");
    previousBtn.addEventListener("click",(event)=>{
      event.preventDefault();
      openForm1();
      scrollToTop();
    })
    var memberId;
    if(action ===  "modify"){
      if(!sessionStorage.getItem('page')){
        sessionStorage.setItem('page',1);
        openForm1();
      }else{
        console.log(sessionStorage.getItem('page'))
        if(sessionStorage.getItem('page') == 1){
          openForm1();
        }else{
          openForm2();
        }
      }
      memberId = updateMemberId;
      nextBtnOne.disabled = false;
      previousBtn.classList.remove('hide');
    }else{
      openForm1();
    }
    profilePreview();
    nextBtnOne.addEventListener("click" , (event)=>{
      event.preventDefault();
      openForm2();
      scrollToTop();
    });
    
    saveBtnOne.addEventListener("click", (event)=>{
      event.preventDefault();
      //call save form1 fucntion
      saveForm1();
    });

    saveBtnTwo.addEventListener("click", (event)=>{
      event.preventDefault();
      //call save form2 function
      saveForm2();
    });

    
    // viweProfileBtns = Array.from(viweProfileBtns);
    // viweProfileBtns.forEach(element => {
    //   element.addEventListener("click" , (event)=>{
    //     event.preventDefault();
    //     //do view profile action
    //   })
    // });

    

    //functions
    
    countrycodes();
    //scroll top function
    function scrollToTop(){
      document.body.scrollTop = 0;
      document.documentElement.scrollTop = 0;
    }
    //open form1 function
    function openForm1(){
      sessionStorage.setItem('page',1);
      console.log(action);
      form2.classList.add("hide");
      form1.classList.remove("hide");
      if(action == "modify"){
          //make member id text field disabled
          document.getElementById("phoneNumber").disabled = true;
          document.getElementById("countryCode").disabled = true;
          //fetch data from api and add it to form
          var dataBody = {
            load : "loadbynumber",
            id : updateMemberId
          }
          dataBody = JSON.stringify(dataBody);
          console.log(dataBody);
          var dataRequestOptions = {
            method : "POST",
            header : myHeaders,
            redirect : "follow",
            body : dataBody
          }

          fetch("../../ws/Memberprofile.php", dataRequestOptions)
          .then(response => response.json())
          .then(result =>{
            console.log(result);
            var status  = (parseInt(result[0].status) == "1")? true : false;
            var admin = (parseInt(result[0].admin) == "1")? true : false;
            var userId = result[0].userid.split(" ");
            document.getElementById("phoneNumber").value = userId[1];
            document.getElementById("countryCode").innerHTML = `<option>`+userId[0]+`</option>`
            document.getElementById("name").value = result[0].Name;
            document.getElementById("surname").value = result[0].Surname;
            document.getElementById("dob").value = result[0].Dob;
            document.getElementById("gender").value = result[0].gender;
            document.getElementById("gotram").value = result[0].gothram;
            document.getElementById("active").checked = status;
            document.getElementById("inactive").checked = !status;
            document.getElementById("admin").checked = admin;
            document.getElementById("nonadmin").checked = !admin;
            document.getElementById("profilePreview").src = result[0].photo;
          })
          .catch(error =>{
            console.log(error);
          });
      }else{
        //do normal action
      }
      chaptersGroups();
      
    }
    function profilePreview(){
      var profileUploadElement = document.getElementById("memberPhoto");
      profileUploadElement.addEventListener('change',()=>{
        const file = profileUploadElement.files[0];
        if(file){
          document.getElementById("profilePreview").src = URL.createObjectURL(file);
        }
      })
    }
    
    function addContactElement(category){
        var repeaterItem = document.createElement("div");
        var repeaterItemRow = document.createElement("div");
        var textBoxContainer = document.createElement("div");
        var selectorContainer = document.createElement("div");
        var deleteBtnContainer = document.createElement("div");
        var textBoxLabel = document.createElement("label");
        var textBox = document.createElement("input");
        var selectorLabel = document.createElement("label");
        var selector = document.createElement("select");
        function createSelectorOptions(){
            //fetch types names form api
            var contactData = {
              load : "loadbyparent",
              id : "contacttypes"
            }
            contactData = JSON.stringify(contactData);
            var contactRequestOptions =  {
              method :"POST",
              redirect : "follow",
              headers : myHeaders,
              body : contactData
            }
            fetch("../../ws/Accessconfig.php",contactRequestOptions).
            then(response => response.json())
            .then(result => {
              console.log(result);
              if(Array.isArray(result)){
                    result.forEach((type)=>{
                        var selectorOption = document.createElement("option");
                        selectorOption.innerHTML = type.ContentName;
                        selectorOption.value = type.ContentName;
                        selector.appendChild(selectorOption);
                    });
              }else{
                console.log("no data");
              }
            })
            .catch(error =>{console.log(error);}); 
            
        }
        var button = document.createElement("button");
        var buttonIcon = document.createElement("i");
        //add attributes to each element
        repeaterItem.setAttribute('class',`repeaterItem`);
        repeaterItemRow.setAttribute('class','row justify-content-between');
        textBoxContainer.setAttribute('class','col-md-4 col-sm-12 form-group');
        textBoxLabel.setAttribute('for','contactDetail');
        textBoxLabel.innerHTML = "Contact Detail";
        textBox.setAttribute('type','text');
        textBox.setAttribute('class','form-control');
        textBox.setAttribute('id','contactDetail');
        textBox.setAttribute('palceholder','Enter Details');
        selectorContainer.setAttribute('class','col-md-4 col-sm-12 form-group');
        selectorLabel.setAttribute('for','contactType');
        selector.setAttribute('name','contactType');
        selector.setAttribute('id','contacttype');
        selector.setAttribute('class','form-control');
        createSelectorOptions();
        deleteBtnContainer.setAttribute('class','col-md-2 col-sm-12 form-group d-flex align-items-center pt-2');
        button.setAttribute('class','btn btn-danger text-nowrap px-1');
        button.setAttribute('type','button');
        button.setAttribute('id','deleteBtn');
        buttonIcon.setAttribute('class','bx bx-x');
        button.innerHTML = "Delete";

        //create element structure
        textBoxContainer.appendChild(textBoxLabel);
        textBoxContainer.appendChild(textBox);

        selectorContainer.appendChild(selectorLabel);
        selectorContainer.appendChild(selector);

        button.appendChild(buttonIcon);
        deleteBtnContainer.appendChild(button);

        repeaterItemRow.appendChild(textBoxContainer);
        repeaterItemRow.appendChild(selectorContainer);
        repeaterItemRow.appendChild(deleteBtnContainer);

        repeaterItem.appendChild(repeaterItemRow);
        console.log(category);
        document.getElementById(category+`Contacts`).appendChild(repeaterItem);
        button.addEventListener('click',()=>{
          console.log(repeaterItem);
          document.getElementById(category+`Contacts`).removeChild(repeaterItem);
        })
    }
    function openForm2(){
      sessionStorage.setItem('page',2);
      form2.classList.remove("hide");
      form1.classList.add('hide');
      //fetch data form api and add build the form
      var categoryData = {
        load : "loadbyparent",
        id : "categories"
      }
      categoryData = JSON.stringify(categoryData);
      var categoryRequestOptions = {
        method : "POST",
        headers : myHeaders,
        redirect : "follow",
        body : categoryData
      }
      fetch("../../ws/Accessconfig.php", categoryRequestOptions)
      .then( response => response.json())
      .then( function (result){
        console.log(result);
        if(Array.isArray(result)){
          document.getElementById("viewProfileBtn").disabled = false;
          var categories = [];
          var catHtml = "";
          for(var i in result){
            if(result[i].status != "0"){
              categories.push(result[i].ContentName);
            }
          }
          for(var i in categories){
            catHtml = catHtml + `<li class="d-inline-block mr-2 mb-1">
                              <fieldset>
                                <div class="checkbox">
                                  <input type="checkbox" class="cat-checkbox-input" data-category="`+categories[i]+`" id="businessCat`+i+`">
                                  <label for="businessCat`+i+`">`+categories[i]+`</label>
                                </div>
                              </fieldset>
                            </li>`;
          }
          document.getElementById("businessCategory").innerHTML = catHtml;
        }
        
      })
      .then(function (){
        //open forms according to check boxes
        var checkBoxes = document.getElementsByClassName("cat-checkbox-input");
        checkBoxes = Array.prototype.slice.call(checkBoxes);
        var i = 0;
        checkBoxes.forEach((item)=>{
          item.addEventListener("click", ()=>{
            var heading = item.nextSibling.nextSibling.innerHTML;
            if(item.checked){
              addCategoryElement(heading);
            }else{
              heading = heading.split(" ");
              heading = heading.join("");
              removeCategoryElement(heading);
            }
          })
        });
      })
      .then(()=>{
        loadForm2(); 
      })
      .catch(error =>{
        console.log(error);
      });  

    }
    function removeCategoryElement(category){
      //target parent node
      var businessDetailsForm = document.getElementById('businessDetailsForm');
      //get child element
      var child = businessDetailsForm.querySelector(`#`+category);
      //remove child
      businessDetailsForm.removeChild(child);
    }
    
    function addCategoryElement(category){
      console.log("adding card")
      var template = document.createElement('template');
      var heading = category;
      var joinedHeading = heading.split(" ");
      joinedHeading = joinedHeading.join("");
      var exist = document.querySelectorAll(`#${joinedHeading}`);
      console.log(exist)
      if(exist.length < 1){
        template.innerHTML = `<div class="row businessCategoryForm" id="`+joinedHeading+`" data-category="`+category+`">
                  <div class="row">
                    <div class="col-8">
                      <div class="card">
                        <div class="card-header bg-primary">
                          <h4 class="card-title text-white">`+heading+` Details</h4>
                        </div>
                        <div class="card-body">
                          <div class="row">
                            <div class="col-md-4">
                              <label class="required">Business Name</label>
                            </div>
                            <div class="col-md-8 form-group">
                              <input type="text" id="businessName-cat" class="form-control" name="fname" placeholder="Business Name">
                            </div>
                            <div class="col-md-4">
                              <label>Description (Editor)</label>
                            </div>
                            <div class="col-md-8 form-group">
                              <fieldset class="form-group">
                                <textarea class="form-control" id="businessDescription-cat" rows="3" placeholder="Textarea"></textarea>
                            </fieldset>
                            </div>
                            <div class="col-md-4">
                              <label class="required">Communication Address</label>
                            </div>
                            <div class="col-md-8 form-group">
                              <fieldset class="form-group">
                                <textarea class="form-control" id="businessCommAddress-cat" rows="3" placeholder="Textarea"></textarea>
                            </fieldset>
                            </div>
                            <div class="col-md-4">
                              <label class="required">Pincode</label>
                            </div>
                            <div class="col-md-8 form-group">
                              <input type="number" id="businessPincode-cat"class="form-control" name="fname" placeholder="Pincode">
                            </div>
                            <div class="col-md-4">
                              <label>City</label>
                            </div>
                            <div class="col-md-8 form-group">
                              <fieldset class="form-group">
                              <input type="text" id="businessCity-cat" class="form-control" name="fname" placeholder="City">
                                
                              </fieldset>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                    <div class="col-4">
                        <div class="row">
                          <div class="col-12">
                            <div class="card">
                              <div class="card-header bg-primary">
                                <h4 class="card-title text-white">Media Content</h4>
                              </div>
                              <div class="card-body">
                                  <div class="form-body">
                                    <div class="col-md-6">
                                      <label for="memberBanner-cat">Banner</label>
                                    </div>
                                    <div class="col-md-12 form-group">
                                      <div class="input-group">
                                        <input  type="file" class="form-control" id="memberBanner-cat">
                                        <label class="input-group-text" for="memberBanner-cat">Upload</label>
                                      </div>
                                      <img src="" alt="" id="bannerPreview" style="width: 10rem;">
                                    </div>
                                    <div class="col-md-6">
                                      <label for="memberLogo-cat">Logo</label>
                                    </div>
                                    <div class="col-md-12 form-group">
                                      <div class="input-group">
                                        <input  type="file" class="form-control" id="memberLogo-cat">
                                        <label class="input-group-text" for="memberLogo-cat">Upload</label>
                                      </div>
                                      <img src="" alt="" id="logoPreview" style="width: 10rem;">
                                    </div>
                                  </div>
                              </div>
                            </div>
                          </div>
                      </div>
                    </div>
                    <div class="col-8">
                      <div class="contactDetails">
                        <div class="row col-12">
                            <div class="card col-12 p-0">
                              <div class="card-header bg-primary row align-items-center justify-content-between">
                                <h4 class="card-title text-white">
                                  Contact Details
                                </h4>
                                <button class="btn btn-primary" id="`+joinedHeading+`Create" type="button"><i class="bx bx-plus"></i>
                                  Add
                                </button>
                              </div>
                              <div class="card-body" id="`+joinedHeading+`Contacts">

                              </div>
                            </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>`;
      }
      
      async function cityOptions(template){
          var businessOption = template.content.firstElementChild.querySelector('#businessCity-cat');
          //get available cities
          var cityBody = {
            load : "loadbyparent",
            id : "chapters"
          }
          cityBody = JSON.stringify(cityBody);
          var cityRequestOptions = {
            method : "POST",
            redirect : "follow",
            body : cityBody,
            headers : myHeaders
          }
          try{
            var result = await fetch("../../ws/Accessconfig.php",cityRequestOptions).then(response => response.json());
            if(Array.isArray(result))    {
              var cityOptions = "";
              result.forEach(item=>{
                cityOptions += `<option value="`+item.ContentName+`">`+item.ContentName+`</option>`;
              })
              console.log(businessOption);
              businessOption.innerHTML = cityOptions;
            }               
          }
          catch(error){
            console.log(error);
          }
            
      
       
      }
      function contactDetails(){
        var createBtn = template.content.querySelector(`#`+joinedHeading+`Create`);
        console.log(createBtn);
        createBtn.addEventListener("click",()=>{
          console.log(joinedHeading);
          addContactElement(joinedHeading);
        });
      }
      function bannerPreview(){
        var profileUploadElement = template.content.querySelector("#memberBanner-cat");
        var image = template.content.querySelector("#bannerPreview");
        profileUploadElement.addEventListener('change',()=>{
          const file = profileUploadElement.files[0];
          if(file){
            image.src = URL.createObjectURL(file);
          }
        })
      }
      function logoPreview(){
        var profileUploadElement = template.content.querySelector("#memberLogo-cat");
        var image = template.content.querySelector("#logoPreview");
        profileUploadElement.addEventListener('change',()=>{
          const file = profileUploadElement.files[0];
          if(file){
            image.src = URL.createObjectURL(file);
          }
        })
      }
      // cityOptions(template);
      contactDetails();
      bannerPreview();
      logoPreview();
      //get parent element for catgories
      var businessDetailsForm = document.getElementById('businessDetailsForm');
      var form = template.content.firstChild;
      businessDetailsForm.appendChild(form);
      
    }
    function loadForm2(){
        console.log('load function called');
        
        if(action === "modify"){
          //open businesss forms according to selectio and add value to them
          //get business profiles
          var getProfilesData = {
            load : "loadbynumber",
            id : updateMemberId
          }
          console.log(getProfilesData);
          getProfilesData = JSON.stringify(getProfilesData);
          var profileRequestOptions = {
            method : "POST",
            header : myHeaders,
            redirect : "follow",
            body : getProfilesData
          }
          fetch("../../ws/businessprofile.php", profileRequestOptions)
          .then( response => response.json())
          .then (result =>{
            console.log(result);
            var checkBoxes = document.getElementsByClassName("cat-checkbox-input");
            checkBoxes = Array.from(checkBoxes);
            console.log(checkBoxes)
            for(var i in result){
              var searchId = result[i].category;
              for(var box in checkBoxes){
                if(searchId == checkBoxes[box].dataset.category){
                  if(!checkBoxes[box].checked){
                    checkBoxes[box].click();
                    var category = checkBoxes[box].dataset.category;
                    var temp = category;
                    category = category.split(" ");
                    category = category.join("");
                    //get form container
                    var form = document.getElementById(category);
                    //add values to form
                    form.querySelector('#businessName-cat').value = result[i].Name;
                    form.querySelector('#businessDescription-cat').value = result[i].Description;
                    form.querySelector('#businessCommAddress-cat').value = result[i].Address;
                    form.querySelector('#businessPincode-cat').value = result[i].pincode;
                    form.querySelector('#businessCity-cat').value = result[i].city;
                    form.querySelector('#bannerPreview').src = result[i].banner;
                    form.querySelector('#logoPreview').src = result[i].logo;
                    loadContacts(temp);
                  }
                }
              }
            }
          })
          .catch(error =>{
            console.log(error);
          });
        }
      }
    function loadContacts(category){
        //get contacts container
        var contactBody = {
          load : "loadmemcontacts",
          id : updateMemberId,
          category
        }
        console.log(contactBody);
        contactBody = JSON.stringify(contactBody);
        var contactRequestOptions = {
          method : "POST",
          redirect : "follow",
          headers : myHeaders,
          body : contactBody
        }
        fetch("../../ws/businessprofile.php",contactRequestOptions)
        .then(response => response.json())
        .then(result =>{
          console.log(result);
          if(Array.isArray(result)){
            //get add button for the category
            category = category.split(" ");
            category = category.join("");
            var contactForm = document.getElementById(category+`Contacts`);
            var createBtn = document.getElementById(category+`Create`);
            for(var i in result){
              createBtn.click();
            }
            //run loop for contact elemets
            var contacts = contactForm.children;
            contacts = Array.from(contacts);
            for(var i in result){
              contacts[i].querySelector('#contacttype').value = result[i].ContentName;
              contacts[i].querySelector('#contactDetail').value = result[i].contactdetails;
            }
            for(var i in contacts){
              if(contacts[i].querySelector('#contactDetail').value == ""){
                  contactForm.removeChild(contacts[i]);
              }
            }
          }
        })
        .catch((error)=>{
          console.log(error);
        })
    }
    function chaptersGroups(){
      //load chapters
      var chapterBody ={
        load : "loadbyparent",
        id : "chapters"
      };
      chapterBody = JSON.stringify(chapterBody);
      var chapterRequestOptions = {
        method : "POST",
        headers : myHeaders,
        redirect : "follow",
        body : chapterBody
      };
      fetch("../../ws/Accessconfig.php" , chapterRequestOptions)
      .then( response => response.json())
      .then( result =>{
        console.log(result);
        if(Array.isArray(result)){
          var chapters = [];
          for(var i in result){
            chapters.push(result[i].ContentName);
          }
          var primaryHTML = "";
          var secondaryHTML = "";
          for(var i in chapters){
            primaryHTML = primaryHTML + `<li class="d-inline-block mr-2 mb-1">
                              <fieldset>
                                <div class="radio">
                                  <input type="radio" name="chapterRadios" class="radio-input-chapters" data-primechapter="`+chapters[i]+`" id="chapter-radio`+i+`">
                                  <label for="chapter-radio`+i+`" >`+chapters[i]+`</label>
                                </div>
                              </fieldset>
                            </li>  `;
            secondaryHTML = secondaryHTML + `<li class="d-inline-block mr-2 mb-1">
                              <fieldset>
                                <div class="checkbox">
                                  <input type="checkbox" class="checkbox-input-chapters" data-secchapter="`+chapters[i]+`" id="chapter-checkbox`+i+`" >
                                  <label for="chapter-checkbox`+i+`">`+chapters[i]+`</label>
                                </div>
                              </fieldset>
                            </li>`;
          }
          //add html to dom
          document.getElementById("chapterRadios").innerHTML = primaryHTML;
          document.getElementById("chapterCheckBoxes").innerHTML = secondaryHTML;
        }
        
      })
      .then(()=>{
          //load groups and add to body
          var groupBody = {
            load : "loadbyparent",
            id : "groups"
          };
          groupBody = JSON.stringify(groupBody);
          var groupRequestOptions ={
            method : "POST",
            headers : myHeaders,
            redirect : "follow",
            body : groupBody
          };

          fetch("../../ws/Accessconfig.php" , groupRequestOptions)
          .then( response => response.json())
          .then( result =>{
            console.log(result);
            if(Array.isArray(result)){
              var groups = [];
              var groupsHtml = "";
              for(var i in result){
                if(result[i].status == "1")
                  groups.push(result[i].ContentName);
              }
              for(var i in groups){
                groupsHtml = groupsHtml + `<li class="d-inline-block mr-2 mb-1">
                                  <fieldset>
                                    <div class="checkbox">
                                      <input type="checkbox" class="checkbox-input-groups" data-group="`+groups[i]+`" id="group-checkbox`+i+`">
                                      <label for="group-checkbox`+i+`" >`+groups[i]+`</label>
                                    </div>
                                  </fieldset>
                                </li>  `;
              }
              document.getElementById("groupCheckBoxes").innerHTML = groupsHtml;
            }
            
          })
          .catch(error =>{
            console.log(error);
          });
      })
      .then(()=>{
        //fecth member chapters filter them to primary and secondary
        if(action == "modify"){
          var primaryChapter = "";
          var secondaryChapters = [];
          var chapterRequestBody = {
            load : "loadmemchapters",
            id : memberId
          };
          chapterRequestBody = JSON.stringify(chapterRequestBody);
          var chapterRequestOptions = {
            method : "POST",
            header : myHeaders,
            redirect : "follow",
            body : chapterRequestBody
          }
          fetch("../../ws/Memberprofile.php",chapterRequestOptions)
          .then(response => response.json())
          .then(result =>{
            console.log(result);
            for(var i in result){
              if(result[i].prime == "1"){
                primaryChapter = result[i].ContentName;
              }else if(result[i].prime == "0"){
                secondaryChapters.push(result[i].ContentName);
              }
            }
            var chapterRadio = document.getElementsByClassName("radio-input-chapters");
            chapterRadio = Array.from(chapterRadio);
            chapterRadio.forEach((item)=>{
              if(item.dataset.primechapter == primaryChapter){
                item.checked = true;
              }else{
                item.checked = false;
              }
            });
            console.log(secondaryChapters);
            var chapterBox = document.getElementsByClassName("checkbox-input-chapters");
            chapterBox = Array.from(chapterBox);
            chapterBox.forEach((item)=>{
              console.log(item);
              secondaryChapters.forEach((element)=>{
                if(item.dataset.secchapter == element){
                  item.checked = true;
                }
                else{
                  item.checked = false;
                }
              })
            })
          })
          .catch(error =>{
            console.log(error);
          })
          //add values to primary chapter
          //add values to secondary chapters
          var groups = [];
          //fetch membergroups
          var groupBody = {
            load : "loadmemgroups",
            id : memberId
          }
          groupBody = JSON.stringify(groupBody);
          var groupRequestOptions = {
            method : "POST",
            redirect : "follow",
            headers : myHeaders,
            body : groupBody
          }
          fetch("../../ws/Memberprofile.php",groupRequestOptions)
          .then(response => response.json())
          .then(result =>{
            console.log(result);
            for(var i in result){
              groups.push(result[i].ContentName);
            }
            var groupBoxes = document.getElementsByClassName("checkbox-input-groups");
            groupBoxes = Array.from(groupBoxes);
            groupBoxes.forEach((item)=>{
              groups.forEach((element)=>{
                if(item.dataset.group == element){
                  item.checked = true;
                }
                else{
                  item.checked = false;
                }
              })
            });
        })
        .catch(error=>{
          console.log(error);
        })
        }
        
      })
      .catch(error =>{
        console.log(error);
      });

      
    }
    async function resetPassword(){
      //call api with the data
      var data = {
        load : "logindetchange",
        id : "nkk",
        newpwd : "seal123$$"
      }
      data = JSON.stringify(data);
      console.log(data);
      var requestOptions = {
        method : "POST",
        redirect : "follow",
        headers : myHeaders,
        body : data
      }
      try{
        var result = await fetch('../../ws/Memberprofile.php',requestOptions).then(response => response.json());
        console.log(result);
        if(result.code == "200"){
          toast("Password Reset Successfull!","bg-success");
        }else{
          toast("Unable to reset password","bg-warning");
        }
      }catch(error){
        console.log(error);
        toast("Unable to reset password","bg-danger");
      }
    }
    //save form 1 function
    async function saveForm1(){
      document.getElementById("saveBtnOne").disabled = true;

      //prepare data object for form1
      var photo="";
      var password = "seal123$$";
      var load = "addEntry";
      if( action === "modify"){
        load = "";
        photo = (document.getElementById("profilePreview").src) ? document.getElementById("profilePreview").src : "";
      }
      let formdata = new FormData();
      memberId = document.getElementById('countryCode').value + ` `+ document.getElementById("phoneNumber").value ;
      //uploadig files if exists
      if(memberPhoto.files.length > 0){
          var date = new Date();
          date = date.getTime();
          var newFileName = date + memberPhoto.files[0].name;
          formdata.set("file" , memberPhoto.files[0] , newFileName);
          await fetch("../../ws/upload.php" , {method : "POST" , body : formdata});
          photo = `../../uploads/`+ newFileName;
      }
      var status = (document.getElementById("active").checked)? 1 : 0;
      var admin = (document.getElementById("admin").checked)? 1 : 0;
      
      if(document.getElementById("name").value){
        name = document.getElementById("name").value;
      }
      var surName = "";
      if(document.getElementById("surname").value){
        surName = document.getElementById("surname").value;
      }
      var dob="";
      if(document.getElementById("dob").value){
        dob = document.getElementById("dob").value;
      }
      var gothram = "";
      if(document.getElementById("gotram").value){
        gothram = document.getElementById("gotram").value;
      }
      var profileData = {
          load : load,
          id : memberId,
          Name : name,
          surName : surName,
          dob : dob,
          gender : document.getElementById("gender").value,
          Gothram : gothram,
          photo : photo,
          admin : admin,
          status : status,
          pwd : password
      }
      console.log(profileData);
      profileData = JSON.stringify(profileData);
      if(validateForm1()){
        //check mobile number existence
        if( action == "add"){
          var response = await exists(memberId);
          if(!response){
            removeError(document.getElementById("phoneNumber").parentNode);
            //send data to database
            var response = await sendBasicData(profileData);
            if(response){
              //send groups and chapters data
              response = await saveChaptersGroups();
              if(response){
                //show success info toast
                toast("Saved successfully","bg-success");
                document.getElementById('nextBtnOne').disabled = false;
                document.getElementById('saveBtnOne').disabled = true;
              }else{
                //show failure info toast
                toast("Error saving data", "bg-danger");
                document.getElementById("saveBtnOne").disabled = false;
                //delete member record created and chapters if exists
              }
            }            
          }else{
            toast("The mobile number exists","bg-warning");
            showError(document.getElementById("phoneNumber").parentNode,"This Number Exists");
            document.getElementById("saveBtnOne").disabled = false;
          }
        }else{
          var response = await  sendBasicData(profileData);
          if(response){
            //send groups and chapters data
            response = await saveChaptersGroups();
            if(response){
              //show success info
              toast("Updated successfully","bg-success");
              auth();
              document.getElementById('nextBtnOne').disabled = false;
              document.getElementById('saveBtnOne').disabled = false;
            }else{
              //show failure info do not delete any data
              toast("Updated Failed","bg-danger");
              document.getElementById('saveBtnOne').disabled = false;
            }
          }
        }
      }else{
        toast("Please check the values and try again","bg-warning")
        document.getElementById("saveBtnOne").disabled = false;
      } 
    }
    async function sendBasicData(data){
      var requestOptions = {
        method : "POST",
        redirect : "follow",
        headers : myHeaders,
        body : data
      }
      try {
        var result = await fetch("../../ws/Memberprofile.php",requestOptions).then(response => response.json());
        console.log(result);
        if(result.code == "200"){ 
          return true;
        }else{
          return false;
        }  
      }
      catch(error){
        console.log(error);
        return false;
      }
    }
    async function exists(number){
      var data = {
        load : "loadbynumber",
        id : number
      }
      data = JSON.stringify(data);
      var requestOptions = {
        method : "POST",
        redirect : "follow",
        header : myHeaders,
        body : data
      }
      try{
        var result = await fetch("../../ws/Memberprofile.php",requestOptions).then(response => response.json());
        if(Array.isArray(result)){
          return true;
        }else{
          return false;
        }
      }
      catch(error){
        console.log(error);
        return false;
      }
    }
    function validateForm1(){
      var valid = true;
      var phoneElement = document.getElementById("phoneNumber");
      var nameElement = document.getElementById("name");
      var dobElement = document.getElementById("dob");
      //get primary chapters 
      var chapter="";
      var primaryChapters = document.getElementsByClassName("radio-input-chapters");
      var chapterParent = document.getElementById("chapterRadios");
      primaryChapters = Array.from(primaryChapters);
      primaryChapters.forEach((item)=>{
        if(item.checked){
          chapter = item.nextSibling.nextSibling.innerHTML;
        }
      });

      //get groups for validation
      var groupParent = document.getElementById("groupCheckBoxes");
      var groups = document.getElementsByClassName("checkbox-input-groups");
      var groupItems = []
      groups = Array.from(groups);
      groups.forEach((item)=>{
          if(item.checked)
            groupItems.push(item.nextSibling.nextSibling.innerHTML);
      });

      if(groupItems.length > 0){
        removeError(groupParent);
      }else{
        showError(groupParent , "Please Select a Group");
        valid = false;
      }
      if(chapter != ""){
        removeError(chapterParent);
      }else{
        showError(chapterParent,"Please Select a Chapter");
        valid = false;
      }
      //validate them
      if( validatePhone(phoneElement.value)){
        removeError(phoneElement.parentNode);
      }else{
        removeError(phoneElement.parentNode);
        showError(phoneElement.parentNode,"Please enter a valid phone number");
        valid = false;
      }
      if( validate(nameElement.value)){
        removeError(nameElement);
      }else{
        valid = false;
        showError(nameElement,"This field cannot be empty");
      }
      if(validate(dobElement.value)){
        removeError(dobElement);
      }else{
        valid = false;
        showError(dobElement,"This field cannot be empty");
      }
      return valid;
    }
    
    
    //save form 2 fucntion
    async function saveForm2(){
      //call in loop
      var saveBtn = document.getElementById("saveBtnTwo");
      saveBtn.disabled = true;
      
      var categoryForm = document.getElementsByClassName("businessCategoryForm");
      //for eacg form call add business data form
      categoryForm = Array.from(categoryForm);
      if(categoryForm.length > 0){
        for(var i in categoryForm){
          var response = await addBusinessData(categoryForm[i]);
          if(response == true){
            if(action == "modify"){
              toast("Successfully updated details", "bg-success");
              saveBtn.disabled = false;
            }else{
              toast("Successfully updated details", "bg-success");
              saveBtnOne.disabled = true;
              document.getElementById('viewProfileBtn').disabled = false;
            }
            
          }else if(response == "hold"){
            toast("Please check all fields","bg-warning");
            document.getElementById('saveBtnTwo').disabled = false;
            return 
          }else{
            saveBtn.disabled = false;
            toast("An Error occured while saving your details!<br> Please try again!","bg-danger");
            if(action == "add"){
              var msg = await deleteBusiness();
            }
          }
        }
      }else{
        toast("Please select atleast one category to continue!","bg-warning");
        saveBtn.disabled = false;
        return
      }
      
    }
    async function deleteBusiness(){
      var data = {
        load : "delprofile",
        id : memberId
      }
      data = JSON.stringify(data);
      var requestOptions = {
        method : "POST",
        redirect : "follow",
        headers : myHeaders,
        body : data
      }
      try{
        var result = await fetch("../../ws/businessprofile.php",requestOptions).then(response => response.json());
        console.log(result);
      }
      catch(error){
        console.log(error);
      }
      return true;
    }
    async function saveChaptersGroups(){
      //prepare data object for form3
      //get primary chapter
      var load = "addmemchapters";
      var chapter="";
      var primaryChapters = document.getElementsByClassName("radio-input-chapters");
      primaryChapters = Array.from(primaryChapters);
      primaryChapters.forEach((item)=>{
        if(item.checked){
          chapter = item.nextSibling.nextSibling.innerHTML;
        }
      });
      if(action === "modify"){
        load  = "updatememchapters";
      }
      var primaryBody ={
        load : load,
        id : memberId,
        chapter : chapter,
        prime : 1
      }
      console.log(primaryBody);
      primaryBody = JSON.stringify(primaryBody);
      var primaryRequestOptions = {
        method : "POST",
        headers : myHeaders,
        redirect : "follow",
        body : primaryBody
      };
      //send to api
      
      try{
        var result =await fetch("../../ws/Memberprofile.php", primaryRequestOptions).then( response => response.json());
        if(result.code == "200"){
          console.log("added primary chapters successfully");
          var secondaryChapters = document.getElementsByClassName("checkbox-input-chapters");
          var chapters = [];
          secondaryChapters = Array.from(secondaryChapters);
          secondaryChapters.forEach((item)=>{
              if(item.checked)
                chapters.push(item.nextSibling.nextSibling.innerHTML);
          })
          if(chapters.length > 0){
            for(var i in chapters){
                var response = await addSecChapters(chapters[i]);
                if(!response){
                  console.log("returning false");
                  return false;
                }
            }
          }
          
          //get group
          var groups = document.getElementsByClassName("checkbox-input-groups");
          var groupItems = []
          groups = Array.from(groups);
          groups.forEach((item)=>{
              if(item.checked)
                groupItems.push(item.nextSibling.nextSibling.innerHTML);
          });
          //run loop
          for(var i in groupItems){
            response = await addGroups(groupItems[i]);
            if(!response){
              console.log("return false")
              return false;
            }
          }

          return true;
        }
        else{
          console.log("retruning false");
          return false;
        }   
      }
      catch(error){
        console.log(error);
        return false;
      }
    }
    
    async function addSecChapters(chapter){
        var load = "addmemchapters";
        if(action === "modify"){
          load = "updatememchapters";
        }
        var chapterBody ={
          load : load,
          id : memberId,
          chapter : chapter,
          prime : 0
        }
        chapterBody = JSON.stringify(chapterBody);
        console.log(chapterBody);
        var chapterRequestOptions = {
          method : "POST",
          headers : myHeaders,
          redirect : "follow",
          body : chapterBody
        }
        
        try{
          var result = await fetch("../../ws/Memberprofile.php", chapterRequestOptions).then(response => response.json());
          console.log(result);
          if(result.code == "200"){
            console.log("added secondary chapters successfully")
            return true;
          }else{
            return false;
          }
        }
        catch(errror){
          console.log(error);
          return false;
        }
    }

    async function addGroups(group){
      var load = "addmemgroups";
      if(action === "modify"){
        load = "updatememgroups";
      }
      var groupBody = {
        load : load,
        id : memberId,
        group : group
      }
      groupBody = JSON.stringify(groupBody);
      console.log(groupBody);
      var groupRequestOptions = {
        method : "POST",
        redirect : "follow",
        headers : myHeaders,
        body : groupBody
      }
      
      try{
        var result = await fetch("../../ws/Memberprofile.php", groupRequestOptions).then( response => response.json());
        console.log(result);
        if(result.code == "200"){
          return true;
        }else{
          return false;
        }
      }
      catch(error){
        console.log(error);
        return false;
      }
    }
   async function addBusinessData(category){
      console.log(category);
      var load = "addEntry";
      //send business profile details
      if(action === "modify"){
        //check for existence of business profile if not then load is add
        //load by number all business profiles
        var loadProfile = {
          load : "loadbynumber",
          id : memberId
        }
        loadProfile = JSON.stringify(loadProfile);
        var loadRequestOptions = {
          method :"POST",
          redirect : "follow",
          headers : myHeaders,
          body : loadProfile
        }
        //if category matches then load is update else load is add
        try{
          var result = await fetch("../../ws/businessprofile.php",loadRequestOptions).then(response => response.json());
          console.log(result);
          if(Array.isArray(result)){
              console.log("details found for update")
              result.forEach(item =>{
                if(item.category === category.dataset.category){
                  load = "modify";
                }
              })
          }
          else {
            load = "addEntry";
          }
          var response = await sendData(category,load);
          return response;
        }
        catch(error){
          console.log(error);
          return false;
        }
      }
      else{
        var response  = await sendData(category,load);
        console.log("returned "+response);
        return response;
      } 
    }
    async function sendData(category,load){
      var logo = "";
      var banner ="";
      var pincode = 0;
      let formdata = new FormData();
      var date = new Date();
      date = date.getTime();
      var newFileName = date;
      //uploadig files if exists
      var logoElement = category.querySelector('#memberLogo-cat');
      if(load == "modify"){
        banner = (category.querySelector('#bannerPreview').src) ? document.querySelector('#bannerPreview').src : "";
        logo = (category.querySelector('#logoPreview').src) ? document.querySelector('#logoPreview').src : "";
      }
      var bannerElement = category.querySelector('#memberBanner-cat');
      if(logoElement.files.length > 0){
          newFileName = date + logoElement.files[0].name;
          formdata.set("file" , logoElement.files[0] , newFileName);
          fetch("../../ws/upload.php" , {method : "POST" , body : formdata});
          logo = `../../uploads/`+newFileName;
      }
      if(bannerElement.files.length > 0){
          newFileName = date + bannerElement.files[0].name;
          formdata.set("file" , bannerElement.files[0] , newFileName);
          fetch("../../ws/upload.php" , {method : "POST" , body : formdata});
          banner = `../../uploads/`+newFileName;
      }
      if(category.querySelector('#businessPincode-cat').value != ""){
        pincode = parseInt(category.querySelector('#businessPincode-cat').value);
      }
      var businessProfileData = {
        load : load,
        id : memberId,
        Name : category.querySelector('#businessName-cat').value,
        desc : category.querySelector('#businessDescription-cat').value,
        Address : category.querySelector('#businessCommAddress-cat').value,
        pincode : pincode,
        City : category.querySelector('#businessCity-cat').value,
        category : category.dataset.category,
        status : 1,
        logo : logo,
        banner : banner
      };
      console.log(businessProfileData);
      businessProfileData = JSON.stringify(businessProfileData);
      var businessProfileRequestOptions = {
        method : "POST",
        headers : myHeaders,
        redirect : "follow",
        body : businessProfileData
      }
      //sending data to Database
      if(validateForm2(category)){
        try{
          var result = await fetch("../../ws/businessprofile.php",businessProfileRequestOptions).then(response => response.json());
          console.log(result);  
          if(result.code == "200"){
            var contactContainer = document.getElementById(category.id+`Contacts`);
            var contacts = contactContainer.children;
            contacts = Array.from(contacts);
            for(var i in contacts){
              var response = await addContactDetails(contacts[i],category.dataset.category);
              if(response != true)
                return response;
            }
            return true;
          }else{
            return false;
          }
          
        }
        catch(error){
          console.log(error);
          return false;
        }
      }else{
        return "hold";
      }  
    }
    function validateForm2(category){
      var valid = true;
      var nameElement = category.querySelector('#businessName-cat');
      var addressElement = category.querySelector('#businessCommAddress-cat');
      var pinElement=  category.querySelector('#businessPincode-cat');
      if(validate(nameElement.value)){
        removeError(nameElement);
      }
      else{
        showError(nameElement,"Please fill this field");
        valid = false;
      }
      if(validate(addressElement.value)){
        removeError(addressElement);
      }
      else{
        showError(addressElement,"Please fill this field");
        valid = false;
      }
      if(validate(pinElement.value)){
        removeError(pinElement);
      }
      else{
        showError(pinElement,"Please fill this field");
        valid = false;
      }
      return valid;
    }
    async function addContactDetails(contact,category){
      var response;
      if(action === "modify"){
        response = await updateContacts(contact,category);
        return response;
      }else{
        response  = await insertContacts(contact,category);
        return response;
      }
      
    }
    //updating existing contacts
    async function updateContacts(contact,category){
      //clear previous data
      var clearData = {
        load : "clearmemcontacts",
        id : memberId,
        category
      }
      console.log(clearData);
      clearData = JSON.stringify(clearData);
      var clearRequestOptions = {
        method : "POST",
        redirect : "follow",
        headers : myHeaders,
        body : clearData
      }
      try{
        var result = await fetch("../../ws/businessprofile.php",clearRequestOptions).then(response => response.json());
        console.log(result);
        if(result.code == "200"){
          var response = await insertContacts(contact,category);
          return response;
        }else{
          return false;
        }
      }
      catch(error){
        console.log(error);
        return false;
      }
      //clear prev data
    }
    //adding new contacts
    async function insertContacts(contact,category){
      var load = "addmemcontacts";
      var contactElement = contact.querySelector('#contactDetail');
      var contactData = {
        load : load,
        id : memberId,
        contactdetails : contactElement.value,
        contacttype : contact.querySelector('#contacttype').value,
        category : category
      };
      console.log(contactData);

      
      var contactRequestOptions = {
        method : "POST",
        headers : myHeaders,
        redirect : "follow",
        body : JSON.stringify(contactData)
      };
      
      if(validateContacts()){
        try{
          var result = await fetch("../../ws/businessprofile.php", contactRequestOptions).then(response => response.json());
          console.log(result);
          if(result.code == "200"){
            return true;
          }else{
            return false;
          }
        }
        catch(error)
        {
          console.log(error);
          return false;
        }
      }else{
        return "hold";
      }
      function validateContacts(){
        var valid = true;
        if(contactData.contacttype == "Email"){
          if( validateEmail(contactElement.value) ){
            console.log("here treu");
            removeError(contactElement);
          }else{
            showError(contactElement,"Not Valid");
            console.log("here");
            valid = false;
          }
        }else if(contactData.contacttype == "Phone Number"){
          if(validatePhone(contactElement.value)){
            console.log("here treu");
            removeError(contactElement);
          }else{
            showError(contactElement,"Not valid");
            console.log("here");
            valid = false;
          }
          console.log("here");
        }else{
          if(validate(contactElement.value)){
            console.log("here treu");
            removeError(contactElement);
          }else{
            showError(contactElement,"Please fill this field");
            console.log("here");
            valid = false;
          }
        }
        return valid;
      }
      
        
      
    }
    async function viewProfile(){
        var category = "";
        var btn = document.getElementById("viewProfileBtn");
        btn.innerHTML = `<i class="fa fa-spinner fa-spin" aria-hidden="true"></i>`;
        var data = {
          load : "loadbynumber",
          id : memberId
        }
        data = JSON.stringify(data);
        console.log(data);
        var requestOptions = {
          method : "POST",
          redirect : "follow",
          body : data,
          headers : myHeaders
        }
        try{
          var result = await fetch("../../ws/businessprofile.php",requestOptions).then(response => response.json());
          console.log(result);
          if(Array.isArray(result)){
            category = result[0].category;
            var temp = memberId.slice(1);
            window.open(`./viewBusinessProfile.html?category=`+category+`&memberid=%2B`+temp,'_self');
          }else{
            toast("Cannot view profile","bg-danger");
            btn.innerHTML = "View Profile";
          }
        }
        catch(error){
          console.log(error);
          toast("Cannot view profile","bg-danger");
          btn.innerHTML = "View Profile";
        }
    }
  </script>

</body>

</html>