<!DOCTYPE html>
<html lang="en">

<head>

  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimal-ui">
  <meta name="description"
    content="Frest admin is super flexible, powerful, clean &amp; modern responsive bootstrap 4 admin template with unlimited possibilities.">
  <meta name="keywords"
    content="admin template, Frest admin template, dashboard template, flat admin template, responsive admin template, web app">
  <meta name="author" content="PIXINVENT">
  <title>Search Members</title>
  <link rel="apple-touch-icon" href="../../app-assets/images/ico/apple-icon-120.png">
  <link rel="shortcut icon" type="image/x-icon" href="../../app-assets/images/ico/favicon.ico">
  <link href="https://fonts.googleapis.com/css?family=Rubik:300,400,500,600%7CIBM+Plex+Sans:300,400,500,600,700"
    rel="stylesheet">

 <link href="https://fonts.googleapis.com/icon?family=Material+Icons " rel="stylesheet ">
  
  <link rel="stylesheet" type="text/css" href="../../app-assets/vendors/css/vendors.min.css">
  <link rel="stylesheet" type="text/css" href="../../app-assets/vendors/css/charts/apexcharts.css">
  <link rel="stylesheet" type="text/css" href="../../app-assets/vendors/css/extensions/swiper.min.css">
  <link rel="stylesheet" href="../../css/font-awesome-4.7.0/css/font-awesome.min.css">



  <link rel="stylesheet" type="text/css" href="../../app-assets/css/bootstrap.css">
  <link rel="stylesheet" type="text/css" href="../../app-assets/css/bootstrap-extended.css">
  <link rel="stylesheet" type="text/css" href="../../app-assets/css/colors.css">
  <link rel="stylesheet" type="text/css" href="../../app-assets/css/components.css">


  <link rel="stylesheet" type="text/css" href="../../app-assets/css/core/menu/menu-types/horizontal-menu.css">
  <link rel="stylesheet" type="text/css" href="../../app-assets/css/pages/dashboard-ecommerce.css">





  <link rel="icon" href="../../img/core-img/favicon.png" />


  <link rel="stylesheet" href="../../css/responsive.css" />

  <link rel="stylesheet" type="text/css" href="../../css/custom.css" />


  <script src="../../js/modernizr.js"></script>
  <!-- The core Firebase JS SDK is always required and must be listed first -->
  <script src="https://www.gstatic.com/firebasejs/8.6.5/firebase-app.js"></script>

  <!-- TODO: Add SDKs for Firebase products that you want to use
      https://firebase.google.com/docs/web/setup#available-libraries -->
  <script src="https://www.gstatic.com/firebasejs/8.6.5/firebase-analytics.js"></script>

  <script>
      // Your web app's Firebase configuration
      // For Firebase JS SDK v7.20.0 and later, measurementId is optional
      var firebaseConfig = {
          apiKey: "AIzaSyAaX52IZbaEg3gYnMeHRWh5bi-pLEw2-c4",
          authDomain: "sanathana-1558e.firebaseapp.com",
          projectId: "sanathana-1558e",
          storageBucket: "sanathana-1558e.appspot.com",
          messagingSenderId: "69696836774",
          appId: "1:69696836774:web:4edf184e3cfe3608679067",
          measurementId: "G-DRHZRFBMLY"
      };
      // Initialize Firebase
      firebase.initializeApp(firebaseConfig);
      firebase.analytics();
  </script>
  <style>
    .desc-text{
        color : #000;
        font-weight: bold;
    }
    .row{
        margin : 0;
    }
    .hide{
      display: none;
    }
    #memberCard{
        height: 80vh;
        overflow-x: scroll;
    }
    #memberCard::-webkit-scrollbar{
        display: none;
    }
  </style>

</head>

 <body class="bg-grey">


    <div id="navbar-container">
        
    </div>
    <div class=" row p-1" style="position: fixed;bottom:0;z-index: 999999;">
        <div class="col toast-container">
            
        </div>
      </div>
  <div class="body-container" style="margin-top : 10%;">
      <!-- row 1 search box -->
        <div class="row justify-content-center align-items-center">
            <div class="col-md-4 col-12 ">
                <!-- search bar -->
                <input type="search" class="form-control rounded-right form-control-lg shadow pl-2" id="searchBar"
                placeholder="Search">
            </div>
            <div class="col-md-3 col-12">
                <!-- search button -->
                <button class="btn btn-primary search-btn rounded" type="button">
                    <span class="d-none d-sm-block">Search</span>
                  </button>
            </div>
        </div>
        <div class="row justify-content-start col-md-12" id="memberCard" style="margin-top:30px">
           
        </div>
       
      <!-- next per row 3 profile cards -->
  </div>


  <script src="../../js/jquery-2.2.4.min.js"></script>

  <script src="../../js/headroom.js"></script>

  <!-- <script src="../../js/popper.min.js"></script> -->

  <script src="../../js/bootstrap.min.js"></script>

  <script src="../../js/plugins.js"></script>

  <script src="../../js/active.js"></script>

  <script src="../../js/jquery.mobile.custom.min.js"></script>

  <script src="../../js/main.js"></script>

  <script src="../../app-assets/vendors/js/vendors.min.js"></script>
  <script src="../../app-assets/fonts/LivIconsEvo/js/LivIconsEvo.tools.js"></script>
  <script src="../../app-assets/fonts/LivIconsEvo/js/LivIconsEvo.defaults.js"></script>
  <script src="../../app-assets/fonts/LivIconsEvo/js/LivIconsEvo.min.js"></script>

  <script src="../../app-assets/vendors/js/ui/jquery.sticky.js"></script>

  <script src="../../app-assets/js/scripts/configs/horizontal-menu.js"></script>
  <script src="../../app-assets/js/core/app-menu.js"></script>
  <script src="../../app-assets/js/core/app.js"></script>
  <script src="../../app-assets/js/scripts/components.js"></script>
  <script src="../../app-assets/js/scripts/footer.js"></script>
  <script src="../../app-assets/js/scripts/forms/form-repeater.min.js"></script>
  <script src="../index.html"></script>
  <script src="../../js/globalFuntions.js"></script>
  <script>
    $('#navbar-container').load('../components/navbar.html');
    $(document).ready(function() {
        var year = new Date().getFullYear();
        $(".year").text(year);
        // Select all links with hashes
        $('a[href*="#"]')
            // Remove links that don't actually link to anything
            .not('[href="#"]')
            .not('[href="#0"]')
            .click(function(event) {
                // On-page links
                if (
                    location.pathname.replace(/^\//, "") == this.pathname.replace(/^\//, "") &&
                    location.hostname == this.hostname
                ) {
                    // Figure out element to scroll to
                    var target = $(this.hash);
                    target = target.length ? target : $("[name=" + this.hash.slice(1) + "]");
                    // Does a scroll target exist?
                    if (target.length) {
                        // Only prevent default if animation is actually gonna happen
                        event.preventDefault();
                        $("html, body").animate({
                                scrollTop: target.offset().top
                            },
                            1000,
                            function() {
                                // Callback after animation
                                // Must change focus!
                                var $target = $(target);
                                $target.focus();
                                if ($target.is(":focus")) {
                                    // Checking if the target was focused
                                    return false;
                                } else {
                                    $target.attr("tabindex", "-1"); // Adding tabindex for elements not focusable
                                    $target.focus(); // Set focus again
                                }
                            }
                        );
                    }
                }
            });
        // grab an element
        var myElement = document.querySelector("header");
        // construct an instance of Headroom, passing the element
        var headroom = new Headroom(myElement);
        // initialise
        headroom.init();
    });

    $(document).ready(function() {
        $('[data-toggle="tooltip"]').tooltip();
    });
</script>   
  <script>
    //fetch data from api
    var myHeaders = new Headers();
  // myHeaders.append("Content-Type ", "text/plain ");
  // myHeaders.append("Cookie ", "PHPSESSID=a147dbe2815c8b7145c6f2ca214f3716 ");

  

    var profileList = [];
    auth();
    loadProfiles(); 
    search();
    function search(){
        var searchBar = document.getElementById('searchBar');
        searchBar.addEventListener('keyup' , (e)=>{
            console.log(e.target.value);
            const searchString = e.target.value.toLowerCase();
            const filteredProfiles = profileList.filter( profile =>{
                return (
                    profile.Name.toLowerCase().includes(searchString) 
                );
            })
            console.log(filteredProfiles);
            displayMembers(filteredProfiles);
        })
    }
    async function loadProfiles(){
        var requestMemeberBody ={
            load : "loadallMemdata"
        }
        requestMemeberBody = JSON.stringify(requestMemeberBody);
        var requestMemberOptions = {
            method : "POST",
            headers : myHeaders,
            redirect : "follow",
            body  : requestMemeberBody
        }
        var memberCard = document.getElementById('memberCard');
        try{
            const response = await  fetch("../../ws/Memberprofile.php" , requestMemberOptions).then(response => response.json());
            if(Array.isArray(response)){
                profileList = response;
                displayMembers(response);
            }
            else{ 
                loadEmptyState(document.querySelector('.body-container'));
            }
        }  
        catch(error){
            console.log(error);
        }      
    }
    async function loadEmptyState(element){
        var mainSection = element;
        var empty = document.createElement('div');
        var button = `<div class="col-6 text-center">
                        <a href="./main.html" class="btn btn-primary">Add members</a>
                    </div>`;
        empty.innerHTML = `
                    <div class="row align-items-center justify-content-around">
                        <div class="col-4">
                            <img src="#" alt="" id="emptyImage" width="100%">
                            <h4 class="text-center">No Members</h4>
                        </div>
                        `+button+`
                </div>`;
        empty = await emptyState(empty,"member-list");
        mainSection.innerHTML = "";
        mainSection.appendChild(empty);
    }
    function displayMembers(profiles){
        console.log(profiles);
        if(profiles.length > 0){
            //get profile card body
            const cardHtml = (profiles)
                .map((profile) =>{
                    if(profile.photo == ""){
                        if(profile.gender === "Male"){
                            profile.photo = "../../images/emptystates/male.png"
                        }else{
                            profile.photo = "../../images/emptystates/female.png"
                        }
                    }
                    var status = "success";
                    if(profile.status == 0){
                        status = "danger"
                    }
                    var profileStatus = (profile.status == 0) ? "In Active" : "Active";
                    var privilige = (profile.admin == "1") ? "admin" : "user";
                    var icon = (profile.admin == "1") ? "admin_panel_settings" : "person";
                    var adminColor = (profile.admin == "1") ? "primary" : "warning"
                    var id = profile.userid.replace("+","%2b");
                    return `
                    <div class="col-md-4">
                <div class="card py-2   text-right" style="margin-bottom: 5%; ">
                    
                    <div class="card-body py-1 ">
                        <div class="row justify-content-between mb-1">
                            <img src="`+profile.photo+`" alt="" height="100px" width="100px" style="border-radius : 50%">
                            <div >
                                <h3 class=" pl-0 text-secondary">
                                    `+profile.Name+`
                                    <a href="./member_form.html?action=modify&memberId=`+id+`">
                                        <span class="material-icons onlyAdmin">
                                                edit
                                        </span>
                                    </a>
                                </h3>
                                <div class="chip chip-`+adminColor+`" >
                                        <div class="avatar bg-`+adminColor+`">
                                            <span class="material-icons " style="font-size : 1rem">
                                                `+icon +`
                                            </span>
                                        </div>
                                    <span class="chip-text text-white" style="font-size: .7rem; padding: 0.2rem;">
                                        `+ privilige +`
                                    </span>
                                </div>
                                <div class="chip chip-`+status+`" >
                                        
                                    <span class="chip-text text-white" style="font-size: .7rem; padding: 0.2rem;">
                                        `+ profileStatus +`
                                    </span>
                                </div>
                                
                            </div>
                        </div>
                        <div class="row col-md-12 mb-1 justify-content-between">
                            <span class="desc-text">
                                Phone
                            </span>
                            <span >
                                <span class="material-icons mr-1 align-middle info">
                                    local_phone
                                </span>
                                `+profile.userid+`
                            </span>
                        </div>
                        <div class="row col-md-12 mb-1 justify-content-between">
                            <span class="desc-text">
                                Gender
                            </span>
                            <span>
                                <span class="material-icons mr-1 align-middle info">
                                    `+ profile.gender.toLowerCase() +`
                                </span>
                                `+profile.gender+`
                            </span>
                        </div>
                        <div class="row col-md-12 mb-1  justify-content-between">
                            <span class="desc-text">
                                Gothram
                            </span>
                            <span>
                                <span class="material-icons mr-1 align-middle info">
                                    self_improvement
                                </span>
                                `+profile.gothram+`
                            </span>
                        </div>
                        <div class="row col-md-12 justify-content-between">
                            <span class="desc-text">
                                Date Of Birth
                            </span>
                            <span class="row align-items-end">
                                <span class="material-icons mr-1 info">
                                cake
                                </span>
                                `+profile.Dob+`
                            </span>
                        </div>
                    </div>
                </div>
            </div>
                `;   
            }).join('');
            var memberCard = document.getElementById('memberCard');
            memberCard.innerHTML = cardHtml;
        }else{
            loadEmptyState(document.getElementById('memberCard'));
        }
        
    }
    </Script>

    
</body>

</html>