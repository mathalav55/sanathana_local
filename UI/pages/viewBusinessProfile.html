<!DOCTYPE html>
<html lang="en">

<head>

    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimal-ui">
    <meta name="description" content="Frest admin is super flexible, powerful, clean &amp; modern responsive bootstrap 4 admin template with unlimited possibilities.">
    <meta name="keywords" content="admin template, Frest admin template, dashboard template, flat admin template, responsive admin template, web app">
    <meta name="author" content="PIXINVENT">
    <title>View Profile</title>
    <link rel="apple-touch-icon" href="../../app-assets/images/ico/apple-icon-120.png">
    <link rel="shortcut icon" type="image/x-icon" href="../../app-assets/images/ico/favicon.ico">
    <link href="https://fonts.googleapis.com/css?family=Rubik:300,400,500,600%7CIBM+Plex+Sans:300,400,500,600,700" rel="stylesheet">


    <link rel="stylesheet" type="text/css" href="../../app-assets/vendors/css/vendors.min.css">
    <link rel="stylesheet" type="text/css" href="../../app-assets/vendors/css/charts/apexcharts.css">
    <link rel="stylesheet" type="text/css" href="../../app-assets/vendors/css/extensions/swiper.min.css">
    <link rel="stylesheet" href="../../css/font-awesome-4.7.0/css/font-awesome.min.css">



    <link rel="stylesheet" type="text/css" href="../../app-assets/css/bootstrap.css">
    <link rel="stylesheet" type="text/css" href="../../app-assets/css/bootstrap-extended.css">
    <link rel="stylesheet" type="text/css" href="../../app-assets/css/colors.css">
    <link rel="stylesheet" type="text/css" href="../../app-assets/css/components.css">


    <link rel="stylesheet" type="text/css" href="../../app-assets/css/core/menu/menu-types/horizontal-menu.css">
    <link rel="stylesheet" type="text/css" href="../../app-assets/css/pages/dashboard-ecommerce.css">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons " rel="stylesheet ">




    <link rel="icon" href="../../img/core-img/favicon.png" />


    <link rel="stylesheet" href="../../css/responsive.css" />

    <link rel="stylesheet" type="text/css" href="../../css/custom.css" />


    <script src="../../js/modernizr.js"></script>
    <!-- The core Firebase JS SDK is always required and must be listed first -->
    <script src="https://www.gstatic.com/firebasejs/8.6.5/firebase-app.js"></script>

    <!-- TODO: Add SDKs for Firebase products that you want to use
        https://firebase.google.com/docs/web/setup#available-libraries -->
    <script src="https://www.gstatic.com/firebasejs/8.6.5/firebase-analytics.js"></script>

    <script>
        // Your web app's Firebase configuration
        // For Firebase JS SDK v7.20.0 and later, measurementId is optional
        var firebaseConfig = {
            apiKey: "AIzaSyAaX52IZbaEg3gYnMeHRWh5bi-pLEw2-c4",
            authDomain: "sanathana-1558e.firebaseapp.com",
            projectId: "sanathana-1558e",
            storageBucket: "sanathana-1558e.appspot.com",
            messagingSenderId: "69696836774",
            appId: "1:69696836774:web:4edf184e3cfe3608679067",
            measurementId: "G-DRHZRFBMLY"
        };
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        firebase.analytics();
    </script>
    <style>
        #business-image{
            height: 100px;
            width: 100px;
        }
        .chip-text{
            font-weight: 500;
        }
        .banner{
            height: 200px;
            width: 100%;
        }
        .row{
            margin : 0;
        }
        .products{
            height: 30vh;
            overflow-y: scroll;
        }
        /* .products::-webkit-scrollbar{
            display: none;
        } */
        
    </style>
</head>

<body>

    <!-- ***** Header Area Start ***** -->
    <!-- <section> -->
        <div id="navbar-container" style="display: none;">

        </div>
        <div class=" row p-1" style="position: fixed;bottom:0;z-index: 999999;">
            <div class="col toast-container">
                
            </div>
          </div>
        <div class="non-login-header">
            <section>
                <header class=" float-left header_area headroom headroom--not-bottom headroom--pinned headroom--top" >
                    <div class="row align-items-center py-1">
                        <!-- Menu Area Start -->
                        <div class="col-12">
                            <div class="menu_area">
                                <nav class="navbar navbar-expand-xl px-1 py-0">
                                    <!-- Logo -->
                                    <a href="../index.html"><img src="../../img/bg-img/logo.png" class="img-fluid logo-width" alt="Brand Logo" /></a>
                                    <a href="#home">
                                        <h4 class="logo-font  ml-1 text-white">Sanathana Entrepreneurs Association</h4>
                                    </a>
                                    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#ca-navbar" aria-controls="ca-navbar" aria-expanded="false" aria-label="Toggle navigation">
                                    <span class="navbar-toggler-icon"></span>
                                    </button>
                                    <!-- Menu Area -->
                                    <div class="navbar-collapse collapse" id="ca-navbar">
                                        <ul class="nav navbar-nav ml-auto" id="nav">
                                            <li class="nav-item"><a class="nav-link px-3 " href="whysea.html" target="_blank">Why SEA</a></li>
                                            <!-- <li class="nav-item"><a class="nav-link px-3" href="#features">Features</a></li> -->
                                            <li class="nav-item"><a class="nav-link px-3 " href="#applications">Blog</a></li>
                                            <a class="" href="./login.html"> <button type="button" class="btn btn-light-warning  mr-1 mb-1" id="login-btn">Member Login</button></a>
                                            <a class="" href="./businessProfiles.html"><button type="button" class="btn badge-circle-light-danger mr-1 mb-1">Search</button></a>
        
                                        </ul>
                                    </div>
                                </nav>
                            </div>
                        </div>
                    </div>
                </header>
            </section>
        </div>
    <!-- </section> -->

    <section class="bg-grey" style=" padding-top:10%">
        <div class="container-fluid float-left" style="width:100% !important;">
            
            <div class="row align-items-center">
                <!-- Menu Area Start -->
                <div class="col-12">
                    <div class="menu_area">
                        
                    </div>
                </div>
            </div>
        </div>
    </section>
    <div class="container bg-grey main-section " style="padding-top: 2%;">
        <div class="row">
            <div class="col-12" style="position : relative">
                <img src="../../images/emptystates/banner.jpg"  alt="" class="banner" id="bannerImage">
            </div>
        </div>
        <div class="row justify-content-between align-items-center" style="margin-top : -5%">
            <div class="col-2 ml-2 card" >
                <img src="../../images/emptystates/logo.jpg" alt=""  class="logo" id="logoImage">
            </div>
            <div class="col-8" id="editProfileSection restrict">
                <div class="row justify-content-end addProductsBtn">
                    <button onclick="prodcutForm()" class="btn btn-warning mr-1"><i class="bx bx-plus" style="background-color: rgba(255, 255, 255, 0.425);color: #fff;border-radius: 100%;padding : 0.2rem;"></i> Add Products</button>
                </div>
            </div>
        </div>
        <div class="row mt-2">
            <div class="col-md-3" id="left-cards">
                <div class="row" >
                    <div class="col-md-12">
                        <div class="card">
                            <div class="card-header" style="margin-top : -8%; margin-left: -2%; padding-left: 0;">
                                <div class="chip chip-primary">
                                    <span class="chip-text text-white" style="font-size: 1.2rem; padding: 0.4rem;">
                                        Chapters
                                    </span>
                                </div>   
                            </div>
                            <div class="card-body" id="chaptersData">
                                <div class="row">
                                    no chapters
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row" >
                    <div class="col-md-12">
                        <div class="card">
                            <div class="row justify-content-start card-header" style="margin-top : -8%; margin-left: -2%; padding-left: 0;">
                                <div class="chip chip-primary">
                                    <span class="chip-text text-white" style="font-size: 1.2rem; padding: 0.4rem;">
                                        Groups
                                    </span>
                                </div>   
                            </div>
                            <div class="card-body" id="groupsData">
                                <div class="row">
                                    no groups 
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                    <div class="card">
                        <div class="row justify-content-center card-header"  style="margin-top: -5%;">
                            <div class="chip chip-primary">
                                <span class="chip-text text-white" style="font-size: 1.2rem; padding: 0.4rem;" id="businessTitle">
                                    About
                                </span>
                            </div>   
                        </div>
                        <div class="card-body">
                            <span id="businessDescription">

                            </span>
                        </div>
                    </div>
                    <div class="row pt-3 pb-1 justify-content-center card-header"  style="margin-top: -5%;">
                        <div class="chip chip-primary">
                            <span class="chip-text text-white" style="font-size: 1.2rem; padding: 0.4rem;" id="businessTitle">
                                Product Catalog
                            </span>
                        </div>   
                    </div>
                    <div class="products col">
                        
                        
                    </div>
                    <!-- <div class="other-buisness col">
                        <div class="card row">
                            <div class="col">
                                <div class="row card-body justify-content-between">
                                    <div class="col">
                                        <div class="row">
                                            name of the person
                                        </div>
                                        <div class="row">
                                            business logo
                                        </div>
                                    </div>
                                    <div class="col">
                                        <div class="row"></div>
                                        <div class="row">
                                            <div class="col">
                                                <div class="row">
                                                    business name
                                                </div>
                                                <div class="row">
                                                    email
                                                </div>
                                                <div class="row">
                                                    phone number
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col">
                                        <div class="row">
                                            category
                                        </div>
                                        <div class="row">
                                            address
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div> -->
            </div>
            <div class="col-md-3">
                <div class="card">
                    <div class="row justify-content-end card-header" style="margin-top : -8%; margin-right: -2%; padding-right: 0;">
                        <div class="chip chip-primary">
                            <span class="chip-text text-white" style="font-size: 1.2rem; padding: 0.4rem;">
                                Connect
                            </span>
                        </div>   
                    </div>
                    <div class="card-body" id="connectBody">
                        <div class="row">

                        </div>
                    </div>
                </div>
                <div class="card">
                    <div class="card-header row justify-content-end"  style="margin-top : -8%; margin-right: -2%; padding-right: 0;">
                        <div class="chip chip-primary">
                            <span class="chip-text text-white" style="font-size: 1.2rem; padding: 0.4rem;">
                                Details
                            </span>
                        </div>   
                    </div>
                    <div class="card-body" id="detailsBody">
                        
                    </div>
                </div>
            </div>
        </div>
        
        <div class="row py-2 justify-content-center other-buisness-section">
            <div class="chip chip-warning">
                <span class="chip-text text-bold-500 text-white" style="font-size: 1.5rem; padding: 0.4rem;">
                    Other Business
                </span>
            </div> 
        </div>
        <div class="container row justify-content-center">
            <div class="col-9 other-business">

            </div>
        </div>
        <div class="row">
            <!-- <div class="col-12 card px-0">
                <div class="card-header bg-primary">
                    <h2 class="card-title text-white">
                        change password
                    </h2>
                </div>
                <div class="card-body">
                    <form action="" class="form-horizontal">
                        <div class="row form-body">
                            <div class="col-12">
                                <label for="contentName">Old Password</label>
                                <div class="form-group">
                                    <input type="password" id="oldPassword" class="form-control" placeholder="oldPassword">
                                </div>
                            </div>
                            <div class="col-12">
                                <label for="contentName">New Password</label>
                                <div class="form-group">
                                    <input type="password" id="oldPassword" class="form-control" placeholder="oldPassword">
                                </div>
                            </div>
                            <div class="col-12">
                                <label for="contentName">Confirm New Password</label>
                                <div class="form-group">
                                    <input type="password" id="oldPassword" class="form-control" placeholder="oldPassword">
                                </div>
                            </div>
                            <div class="col-12">
                                <button type="button" class="btn btn-primary">
                                    <span class="d-none d-sm-block">Reset Password</span>
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
            </div> -->
        </div>
    </div>
    <!-- ***** Footer Area End ***** -->
    <!-- Start of Async Drift Code -->
    <script>
        "use strict";

        !(function() {
            var t = (window.driftt = window.drift = window.driftt || []);
            if (!t.init) {
                if (t.invoked) return void(window.console && console.error && console.error("Drift snippet included twice."));
                (t.invoked = !0),
                (t.methods = ["identify", "config", "track", "reset", "debug", "show", "ping", "page", "hide", "off", "on"]),
                (t.factory = function(e) {
                    return function() {
                        var n = Array.prototype.slice.call(arguments);
                        return n.unshift(e), t.push(n), t;
                    };
                }),
                t.methods.forEach(function(e) {
                        t[e] = t.factory(e);
                    }),
                    (t.load = function(t) {
                        var e = 3e5,
                            n = Math.ceil(new Date() / e) * e,
                            o = document.createElement("script");
                        (o.type = "text/javascript"),
                        (o.async = !0),
                        (o.crossorigin = "anonymous"),
                        (o.src = "https://js.driftt.com/include/" + n + "/" + t + ".js");
                        var i = document.getElementsByTagName("script")[0];
                        i.parentNode.insertBefore(o, i);
                    });
            }
        })();
        drift.SNIPPET_VERSION = "0.3.1";
        drift.load("6ashbsefxhx7");
    </script>
    <!-- End of Async Drift Code -->
    <!-- ***** App Screenshots Area End *****====== -->
    <script>
        (function(i, s, o, g, r, a, m) {
            i["GoogleAnalyticsObject"] = r;
            (i[r] =
                i[r] ||
                function() {
                    (i[r].q = i[r].q || []).push(arguments);
                }),
            (i[r].l = 1 * new Date());
            (a = s.createElement(o)), (m = s.getElementsByTagName(o)[0]);
            a.async = 1;
            a.src = g;
            m.parentNode.insertBefore(a, m);
        })(window, document, "script", "https://www.google-analytics.com/analytics.js", "ga");

        ga("create", "UA-96096445-4", "auto");
        ga("send", "pageview");
    </script>
    <!-- Go to www.addthis.com/dashboard to customize your tools -->
    <!-- <script src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-58d9fa1af7a79649"></script> -->
    <!-- Jquery-2.2.4 JS -->
    <script src="../../js/jquery-2.2.4.min.js"></script>
    <!-- Headroom js -->
    <script src="../../js/headroom.js"></script>
    <!-- Popper js -->
    <!-- <script src="../../js/popper.min.js"></script> -->
    <!-- Bootstrap-4 Beta JS -->
    <script src="../../js/bootstrap.min.js"></script>
    <!-- All Plugins JS -->
    <script src="../../js/plugins.js"></script>
    <!-- Active JS -->
    <script src="../../js/active.js"></script>
    <!-- Resource jQuery -->
    <script src="../../js/jquery.mobile.custom.min.js"></script>
    <!-- Resource jQuery -->
    <script src="../../js/main.js"></script>
    <script src="../../app-assets/vendors/js/vendors.min.js"></script>
    <script src="../../app-assets/fonts/LivIconsEvo/js/LivIconsEvo.tools.js"></script>
    <script src="../../app-assets/fonts/LivIconsEvo/js/LivIconsEvo.defaults.js"></script>
    <script src="../../app-assets/fonts/LivIconsEvo/js/LivIconsEvo.min.js"></script>
    <!-- BEGIN Vendor JS-->

    <!-- BEGIN: Page Vendor JS-->
    <script src="../../app-assets/vendors/js/ui/jquery.sticky.js"></script>
    <!-- END: Page Vendor JS-->

    <!-- BEGIN: Theme JS-->
    <script src="../../app-assets/js/scripts/configs/horizontal-menu.js"></script>
    <script src="../../app-assets/js/core/app-menu.js"></script>
    <script src="../../app-assets/js/core/app.js"></script>
    <script src="../../app-assets/js/scripts/components.js"></script>
    <script src="../../app-assets/js/scripts/footer.js"></script>
    <script src="../../js/globalFuntions.js"></script>
    <!-- END: Theme JS-->
    <!-- Headroom -->
    <script>
        const myHeaders = new Headers();
        var category;
        var profileList = [];
        
        var userData = {}
        async function profile(){
            var authRequestOptions = {
            method : "POST",
            redirect : "follow",
            headers : myHeaders,
            body : ""
            }
            var result = await fetch("../../ws/auth.php",authRequestOptions)
            .then(response => response.json());
            return result;
        }
        async function loadData(){
            try{
                profile().then(response =>{
                    userData = response;
                    console.log(userData);
                    if(userData.status == "Logged In")
                    {
                        document.querySelector('.non-login-header').style.display = "none";
                        document.querySelector('#navbar-container').style.display = "block";
                        $('#navbar-container').load('../components/navbar.html');
                        if(userData.privilige != "Admin" && userData.privilige !="Core Member")
                            restrict();
                        auth();
                    }else{
                        restrict();
                    }
                })
            }
            catch(error){
                console.log(error);
            }
        }
        loadData();
        //loading profile
        getUrlData();
        function restrict(){
            console.log("restricting")
            var restrictedElements = document.querySelectorAll('.restrict');
            restrictedElements = Array.from(restrictedElements);
            restrictedElements.forEach(element=>{
                var temp = element;
                element.parentNode.removeChild(temp);
            });
        }
        function getUrlData(){
            const params = (new URL(document.location)).searchParams;
            if(params.get('category')){
                category = params.get('category');
                console.log(category);
            }
            if(params.get('memberid')){
                memberId = params.get('memberid');
                console.log(memberId);
            }
            
            loadBasicProfile();
            loadProducts();
        }
        function prodcutForm(){
            var temp = memberId.slice(1);
            var url = `./productForm.html?category=`+category+`&memberid=%2B`+temp+``;
            window.location=url;
        }
        function loadProducts(){
            //get data from api
            //get the section
            var productsSection = document.querySelector('.products');
            //make template and add to inner html
            var productBody = {
                load : "loadproducts",
                id : memberId,
                category : category
            }
            productBody = JSON.stringify(productBody);
            var productRequestOptions = {
                method : "POST",
                redirect : "follow",
                headers : myHeaders,
                body : productBody
            }
            fetch("../../ws/businessprofile.php",productRequestOptions)
            .then(response => response.json())
            .then(result => {
                console.log(result);
                if(Array.isArray(result)){
                    var productCard = "";
                    
                    result.forEach(item =>{
                        var broucher = item.broucher;
                        var video = item.video;
                        if(broucher == ""){
                            broucher = "javascript:void(0)";
                        }
                        if(video == ""){
                            video = "javasript:void(0)";
                        }
                        productCard +=  `<div class="card">
                            <div class="row card-body justify-content-between">
                                    <div class="col text-left">
                                        <div class="chip chip-primary" >
                                            <span class="chip-text text-white" style="font-size: .9rem; padding: 0.2rem;">
                                                `+item.Name+`
                                            </span>
                                        </div>
                                        
                                    </div>
                                    <div class="col-4 text-center">
                                        `+item.Description+`
                                    </div>
                                    <div class="col text-right">
                                        <a href="`+broucher+`" target="_blank">
                                            <span class="material-icons danger">
                                                picture_as_pdf
                                            </span>
                                        </a>
                                    </div>
                                    <div class="col text-right">
                                        <a href="`+video+`" target="_blank">
                                            <span class="material-icons">
                                                play_circle
                                            </span>
                                        </a>
                                    </div>
                            </div>
                        </div>`;
                    });
                    productsSection.innerHTML = productCard;
                }else{        
                    var prodButton = `<button onclick="prodcutForm()" class="btn btn-warning mr-1"><i class="bx bx-plus" style="background-color: rgba(255, 255, 255, 0.425);color: #fff;border-radius: 100%;padding : 0.2rem;"></i> Add Products</button>`;
                    if(userData.privilige != "Admin" && userData.privilige != "Core Member"){
                        prodButton ="";
                    }
                    productsSection.innerHTML = `<div class="card">
                    <div class="col-8 card-body" id=" restrict">
                        <div class="row justify-content-between onlyAdmin align-items-center">
                            <h5  class="text-warning">No products yet!</h5>
                            `+prodButton+`
                        </div>
                    </div>
                    </div>`;
                }
            })
            .catch(error =>{console.log(error);});
        }
        function loadBasicProfile(){
            console.log("loading")
            var profileBody = {
                load : "loadbynumber",
                id : memberId
            }
            profileBody = JSON.stringify(profileBody);
            console.log(profileBody);
            var profileRequestOptions = {
                method : "POST",
                redirect : "follow",
                headers : myHeaders,
                body  : profileBody
            }
            fetch("../../ws/Memberprofile.php",profileRequestOptions)
            .then(response => response.json())
            .then((result)=>{
                console.log(result);
                if(Array.isArray(result)){
                    var basicDetails = result[0];
                    console.log(basicDetails)
                    var groupsData = document.getElementById('groupsData');
                    var chaptersData = document.getElementById('chaptersData');
                    var connectBody = document.getElementById('connectBody');
                    var detailsBody = document.getElementById('detailsBody');
                    var businessDescription = document.getElementById('businessDescription');
                    var businessTitle = document.getElementById('businessTitle');
                    var bannerImage = document.getElementById('bannerImage');
                    var logoImage = document.getElementById('logoImage');
                    detailsBody.innerHTML = `
                        <h3 class="row pb-2 text-bold-500 text-primary">
                            <span>` +basicDetails.Name+`</span>
                        </h3>
                        <div class="row pb-1">
                            <span class="material-icons mr-1 text-primary">
                                    `+ basicDetails.gender.toLowerCase()+`
                            </span>
                            <span>` +basicDetails.gender+`</span>
                        </div>
                        <div class="row pb-1 ">
                            
                            <span class="material-icons mr-1 text-primary">
                                self_improvement
                            </span>
                            <span>` +basicDetails.gothram+` Gothram</span>
                        </div>
                        <div class="row pb-1">
                            <span class="material-icons mr-1 text-primary   ">
                                    cake
                            </span>
                            <span>` +basicDetails.Dob+`</span>
                        </div>
                        `; 
                    //hide or show add products btn
                    
                    //load profile details
                    var businessBody = {
                        load : "loadbynumber",
                        id : memberId
                    }
                    businessBody = JSON.stringify(businessBody);
                    var businessRequestOptions = {
                        method : "POST",
                        redirect : "follow",
                        headers : myHeaders,
                        body : businessBody
                    }
                    fetch("../../ws/businessprofile.php",businessRequestOptions)
                    .then(response => response.json())
                    .then(result => {
                        console.log(result);
                        if(Array.isArray(result)){
                            var profile = {};
                            for(var i in result){
                                if(result[i].category == category){
                                    profile = result[i];
                                }
                            }
                            if(profile.banner === ""){
                                profile.banner = "../../images/emptystates/banner.jpg";
                            }
                            if(profile.logo === ""){
                                profile.logo = "../../images/emptystates/logo.jpg";
                            }
                            bannerImage.setAttribute('src',profile.banner);
                            logoImage.setAttribute('src',profile.logo);
                            businessTitle.innerText = `About ${profile.Name}`;
                            if(profile.Description != ""){
                                businessDescription.innerHTML = profile.Description;
                            }
                            else{
                                businessDescription.innerHTML = "No description Available for this business";
                            }
                        }
                    })
                    .catch(error =>{
                        console.log(error);
                    });
                    //fetch groups data and add to inner html
                    var groupBody = {
                        load : "loadmemgroups",
                        id : memberId
                    }
                    groupBody = JSON.stringify(groupBody);
                    var groupRequestOptions = {
                        method :"POST",
                        redirect : "follow",
                        headers : myHeaders,
                        body : groupBody
                    }
                    fetch("../../ws/Memberprofile.php",groupRequestOptions)
                    .then(response => response.json())
                    .then(result => {
                        console.log(result);
                        if(Array.isArray(result)){
                            //add groups to body
                            var groupHtml = '';
                            for( var i in result){
                                groupHtml = groupHtml + `<div class="row">
                                    `+result[i].ContentName+` 
                                </div>`;
                            }
                            groupsData.innerHTML = groupHtml
                        }else{
                            groupsData.innerHTML = "No groups available"
                        }
                    })
                    .catch(error =>{console.log(error);});


                    //fetch chapters data and add to inner html
                    var chapterBody = {
                        load : "loadmemchapters",
                        id : memberId
                    }
                    chapterBody = JSON.stringify(chapterBody);
                    var chapterRequestOptions = {
                        method : "POST",
                        headers : myHeaders,
                        redirect : "follow",
                        body : chapterBody
                    }
                    fetch("../../ws/Memberprofile.php",chapterRequestOptions)
                    .then(response => response.json())
                    .then(result => {
                        console.log(result);
                        if(Array.isArray(result)){
                            var chapterHtml = '';
                            for( var i in result){
                                chapterHtml = chapterHtml + `<div class="row">
                                    `+result[i].ContentName+` 
                                </div>`;
                            }
                            chaptersData.innerHTML = chapterHtml;
                        }else{
                            chaptersData.innerHTML = "No chapters available "
                        }

                    })
                    .catch(error =>{console.log(error);});
                    //fetch contact details and add to inner html
                    var contactBody = {
                        load : "loadmemcontacts",
                        id : memberId,
                        category : category
                    }
                    contactBody = JSON.stringify(contactBody);
                    var contactRequestOptions = {
                        method : "POST",
                        redirect : "follow",
                        headers : myHeaders,
                        body : contactBody
                    }
                    fetch("../../ws/businessprofile.php",contactRequestOptions)
                    .then(response => response.json())
                    .then(result => {
                        console.log(result);
                        if(Array.isArray(result)){
                            var contactHtml = `<h3 class="row pb-1 text-bold-500 text-primary">
                            `+basicDetails.Name+`
                        </h3>`;
                            for(var i in result){
                                contactHtml = contactHtml + `
                                <div class="row">
                                <span class="material-icons mr-1 text-primary">
                                    contact_page
                                </span>
                                <span>
                                    `+result[i].contactdetails+`
                                </span>
                                </div>`;                                
                            }
                            connectBody.innerHTML = contactHtml;
                        }else{
                            connectBody.innerHTML = "No contact details available"
                        }
                    })
                    .catch(error =>{console.log(error);});
                    //fetch basic details and add to body
                    
                }else{
                    //load empty state
                }
            })
            .catch(error =>{
                console.log(error);
            });
        }
        
        async function loadProfiles(){
        var businessBody = {
          load : "loadbynumber",
          id : memberId
        }
        businessBody = JSON.stringify(businessBody);
        var businessRequestOptions = {
          method : "POST",
          headers : myHeaders,
          redirect : "follow",
          body : businessBody
        }
        fetch("../../ws/businessprofile.php",businessRequestOptions)
        .then(response => response.json())
        .then(result => {
            console.log(result);
            if(Array.isArray(result)){
                profileList = result;
                profileList.forEach(profile=>{
                    var loadContactsBody = {
                        load : "loadmemcontacts",
                        id : memberId,
                        category : profile.category
                    }
                    loadContactsBody = JSON.stringify(loadContactsBody);
                    var loadContactsOptions = {
                        method : "POST",
                        redirect : "follow",
                        headers : myHeaders,
                        body : loadContactsBody
                    }
                    fetch("../../ws/businessprofile.php",loadContactsOptions)
                    .then(response => response.json())
                    .then(result => {
                        console.log(result);
                        var email = "no email";
                        var phoneNumber = "no number";
                        if(Array.isArray(result)){
                            result.forEach(item=>{
                                if(item.ContentName === "Phone Number"){
                                    phoneNumber = item.contactdetails;
                                }else if(item.ContentName === "Email"){
                                    email = item.contactdetails
                                }
                            });
                        }
                        var inedx = profileList.indexOf(profile);
                        profile.email = email;
                        profile.phoneNumber  = phoneNumber;
                        console.log(profileList[inedx]);
                        profileList[inedx] = profile;
                        console.log(profile);
                    })
                    .then(()=>{
                        displayMembers(profileList);
                    })
                    .catch(error =>{
                        // noConnection();
                        console.log(error);
                    });
                })
            }
            else{
                console.log("hello");
                var mainSection = document.querySelector('.main-section');
                mainSection.innerHTML  = "";
                var button = ``;
                if(userData.privilige == "Admin" || userData.privilige == "Core Member"){
                    button = `<div class="col-6 text-center">
                                <a href="./main.html" class="btn btn-primary">Add Profiles</a>
                            </div>`;
                }
                var businessProfiles = document.createElement('div');
                businessProfiles.innerHTML = `<div class="row align-items-center justify-content-around">
                                                <div class="col-4">
                                                    <img src="#" alt="" id="emptyImage">
                                                    <h4 class="text-center">No Profiles</h4>
                                                </div>
                                                `+button+`
                                            </div>`;
                //make a template for the empty state;
                //call empty state function with business profile template as argument
                emptyState(businessProfiles,myHeaders).then((result)=>{
                    mainSection.appendChild(result.firstChild);
                })
            }
        })
        .catch(error =>{console.log(error);});    
    }
    function displayMembers(profiles){
        console.log(profiles);
        var profileCards = document.querySelector('.other-business');
        if(profiles.length > 1){
            console.log(profiles);
            const cardHtml = (profiles)
                .map((profile) =>{
                    if(profile.category == category){
                        return
                    }
                    var editBtn = "";
                    var referBtn = "";
                    if(userData.status === "Logged In"){
                        referBtn = `<button class="btn btn-warning mr-1">
                            <span class="material-icons  align-middle">
                                people
                            </span>
                            Refer
                        </button>`;
                        if(userData.privilige == "Admin" || userData.privilige == "Core Member"){
                            var temp = memberId.slice(1);
                            editBtn = `<a class="btn btn-primary mr-1 text-white" href="./member_form.html?action=modify&memberId=%2B`+temp+`">
                                <span class="material-icons  align-middle">
                                    edit
                                </span>
                                Edit Profile
                                </a>`;
                        }
                    }
                    if(profile.logo === ""){
                        profile.logo = "../../images/emptystates/logo.jpg";
                    }
                    var card = document.createElement("div");
                    card.innerHTML = `<div class="col-md-12 profile-card">
                        <div class="card " style="margin-bottom: 5%;">
                            <div class="card-body py-1 m-1">
                                <div class="col">
                                    <div class="row ">
                                        <div class="col-md-4 col-12 ">
                                            <h3 class="text-bold-500 text-primary">`+profile.BusinessName+`</h3>
                                        </div>
                                        <div class="col-md-4  col-12">
                                            <h5 class="text-bold-500">`+profile.Name+`</h5>
                                        </div>
                                        <div class="col-md-4 col-12">
                                            <div class="chip chip-primary" >
                                                <span class="chip-text text-white" style="font-size: .9rem; padding: 0.2rem;">
                                                    `+ profile.category +`
                                                </span>
                                            </div>
                                
                                        </div>
                                    </div>
                                    <div class="row mt-2">
                                        <div class="col-md-4 col-12">
                                            <img src="`+profile.logo+`" id="business-image" alt="business image">
                                        </div>
                                        <div class="col-md-4 col-12" >
                                            <div class="row mb-2">
                                                <span class="material-icons mr-1 info">
                                                    phone
                                                </span>
                                                <span >
                                                    `+profile.phoneNumber+`
                                                </span>
                                            </div>
                                            <div class="row">
                                                <span class="material-icons mr-1 info">
                                                    mail
                                                </span>
                                                <span>
                                                    `+profile.email+`
                                                </span>
                                            </div>
                                        </div>
                                        <div class="col-md-4 col-12">
                                            <span class="row material-icons danger">
                                                place
                                            </span>
                                            <span class="row ">
                                                `+profile.Address+`
                                            </span>
                                            
                                        </div>
                                    </div>
                                    <div class="card-footer" style="margin-bottom:-7%">
                                        <div class="row justify-content-end">
                                            `+editBtn+`
                                            <button class="btn btn-primary mr-1" onclick="viewProfile('`+profile.category+`','`+memberId+`')">
                                                <span class="material-icons  align-middle">
                                                    visibility
                                                </span>
                                                View Profile
                                            </button>
                                            `+referBtn+`
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;  
                
                
                return card.innerHTML; 
            }).join('');
            profileCards.innerHTML = cardHtml;
        }else{
            // empty(profileCards);
            document.querySelector('.other-buisness-section').style.display = "none";
        }

        
    }
    loadProfiles();
    function viewProfile(category,memberid){
        memberid = memberid.slice(1);
        window.open(`./viewBusinessProfile.html?category=`+category+`&memberid=%2B`+memberid,'_self');
    }
    </script>
</body>

</html>